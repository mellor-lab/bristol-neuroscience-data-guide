
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Bristol GIN for Patch Clamp Data</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css-rules.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bristol GIN for Calcium Imaging Data" href="Bristol%20GIN%20for%20Calcium%20Imaging%20Data.html" />
    <link rel="prev" title="Bristol GIN for Silicon Probe Data" href="Bristol%20GIN%20for%20Silicon%20Probe%20Data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Bristol Neuroscience Data Guide
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Installation%20Instructions%20for%20GIN%20Client.html">
   Installation Instructions for GIN Client
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Installation%20Instructions%20for%20GIN%20Server.html">
   Installation Instructions for GIN Server
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN.html">
   Repository Management with GIN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN%20Web%20Interface.html">
   Repository Management with GIN Web Interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20WinGIN.html">
   Repository Management with WinGIN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN%20Client.html">
   Repository Management with GIN Client
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20Git.html">
   Repository Management with Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Recording%20Metadata.html">
   Recording Metadata
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20via%20Graphical%20Interfaces.html">
   Bristol GIN via Graphical Interfaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20via%20Command%20Line.html">
   Bristol GIN via Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20for%20Silicon%20Probe%20Data.html">
   Bristol GIN for Silicon Probe Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Bristol GIN for Patch Clamp Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20for%20Calcium%20Imaging%20Data.html">
   Bristol GIN for Calcium Imaging Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20for%20Electroencephalogram%20Data.html">
   Bristol GIN for Electroencephalogram Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Converting%20to%20NWB.html">
   Converting to NWB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Converting%20to%20BIDS.html">
   Converting to BIDS
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/Community.html">
   Community
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/Bristol%20GIN%20Project.html">
   Bristol GIN Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/GIN%20Project.html">
   GIN Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/GIN-Tonic%20Project.html">
   GIN-Tonic Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/NWB%20Project.html">
   NWB Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/BIDS%20Project.html">
   BIDS Project
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/dervinism/bristol-neuroscience-data-guide"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/dervinism/bristol-neuroscience-data-guide/issues/new?title=Issue%20on%20page%20%2Ftutorials/Bristol GIN for Patch Clamp Data.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/tutorials/Bristol GIN for Patch Clamp Data.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-gin-account">
   Create GIN Account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-mock-data">
   Download Mock Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-your-research-data-repository">
   Set up Your Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-repository">
   Upload Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remove-content-of-your-local-research-data-repository">
   Remove Content of Your Local Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-your-data-to-standardised-format">
   Convert Your Data to Standardised Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-matlab">
     Convert to NWB Using Matlab
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-matnwb-toolbox">
       Install MatNWB Toolbox
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#record-metadata">
       Record Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-patch-clamp-recording-data">
       Load Patch Clamp Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-intracellular-electrophysiology-recording-data">
       Convert Intracellular Electrophysiology Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-intracellular-recordings-table">
       Create Intracellular Recordings Table
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#group-intracellular-recording-sweeps">
       Group Intracellular Recording Sweeps
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-simultaneously-recorded-sweeps">
         Group Simultaneously Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-sequentially-recorded-sweeps">
         Group Sequentially Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-recordings-into-runs">
         Group Recordings into Runs
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-runs-into-experimental-conditions">
         Group Runs into Experimental Conditions
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-recording-slice-image">
       Add Recording Slice Image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#save-nwb-file">
       Save NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#read-nwb-file">
       Read NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#validate-nwb-file">
       Validate NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#resources">
       Resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-python">
     Convert to NWB Using Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-pynwb">
       Install PyNWB
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-record-metadata">
       Record Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-load-data">
       Load Patch Clamp Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-convert-icephys">
       Convert Intracellular Electrophysiology Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-recordings-table">
       Create Intracellular Recordings Table
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps">
       Group Intracellular Recording Sweeps
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-simultaneous">
         Group Simultaneously Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-sequential">
         Group Sequentially Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-repetitions">
         Group Recordings into Runs
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-conditions">
         Group Runs into Experimental Conditions
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-add-image">
       Add Recording Slice Image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-save">
       Save NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-read">
       Read NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-validate">
       Validate NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-resources">
       Resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-nwb-file-structure-using-hdfview">
     Examine NWB File Structure Using HDFView
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-your-standardised-data-to-remote-repository">
   Upload Your Standardised Data to Remote Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#roll-back-repository-to-an-earlier-version">
   Roll back Repository to an Earlier Version
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acknowledgements">
   Acknowledgements
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Bristol GIN for Patch Clamp Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-gin-account">
   Create GIN Account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-mock-data">
   Download Mock Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-your-research-data-repository">
   Set up Your Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-repository">
   Upload Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remove-content-of-your-local-research-data-repository">
   Remove Content of Your Local Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-your-data-to-standardised-format">
   Convert Your Data to Standardised Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-matlab">
     Convert to NWB Using Matlab
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-matnwb-toolbox">
       Install MatNWB Toolbox
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#record-metadata">
       Record Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-patch-clamp-recording-data">
       Load Patch Clamp Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-intracellular-electrophysiology-recording-data">
       Convert Intracellular Electrophysiology Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-intracellular-recordings-table">
       Create Intracellular Recordings Table
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#group-intracellular-recording-sweeps">
       Group Intracellular Recording Sweeps
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-simultaneously-recorded-sweeps">
         Group Simultaneously Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-sequentially-recorded-sweeps">
         Group Sequentially Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-recordings-into-runs">
         Group Recordings into Runs
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#group-runs-into-experimental-conditions">
         Group Runs into Experimental Conditions
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-recording-slice-image">
       Add Recording Slice Image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#save-nwb-file">
       Save NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#read-nwb-file">
       Read NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#validate-nwb-file">
       Validate NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#resources">
       Resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-python">
     Convert to NWB Using Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-pynwb">
       Install PyNWB
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-record-metadata">
       Record Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-load-data">
       Load Patch Clamp Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-convert-icephys">
       Convert Intracellular Electrophysiology Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-recordings-table">
       Create Intracellular Recordings Table
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps">
       Group Intracellular Recording Sweeps
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-simultaneous">
         Group Simultaneously Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-sequential">
         Group Sequentially Recorded Sweeps
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-repetitions">
         Group Recordings into Runs
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-conditions">
         Group Runs into Experimental Conditions
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-add-image">
       Add Recording Slice Image
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-save">
       Save NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-read">
       Read NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-validate">
       Validate NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-pclamp-convert2nwb-py-resources">
       Resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#examine-nwb-file-structure-using-hdfview">
     Examine NWB File Structure Using HDFView
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-your-standardised-data-to-remote-repository">
   Upload Your Standardised Data to Remote Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#roll-back-repository-to-an-earlier-version">
   Roll back Repository to an Earlier Version
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#acknowledgements">
   Acknowledgements
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="bristol-gin-for-patch-clamp-data">
<span id="tutorials-pclamp"></span><h1>Bristol GIN for Patch Clamp Data<a class="headerlink" href="#bristol-gin-for-patch-clamp-data" title="Permalink to this headline">#</a></h1>
<section id="create-gin-account">
<span id="tutorials-pclamp-create-account"></span><h2>Create GIN Account<a class="headerlink" href="#create-gin-account" title="Permalink to this headline">#</a></h2>
<p>In order to be able to follow this tutorial, you need to have a GIN account either on Bristol GIN or on the public GIN service. GIN web interface documentation has it all explained <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN%20Web%20Interface.html#doc-gin-web-register"><span class="std std-ref">here</span></a>.</p>
<p>After creating the account, login to it by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">login</span>
</pre></div>
</div>
</section>
<section id="download-mock-data">
<span id="tutorials-pclamp-download-data"></span><h2>Download Mock Data<a class="headerlink" href="#download-mock-data" title="Permalink to this headline">#</a></h2>
<p>We are going to download intracellular electrophysiology recording data available in <a class="reference external" href="https://gin.g-node.org/dervinism/icephys_mock_repo">dervinism/icephys_mock_repo</a> repository. To get the data, type in the lines below to your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">get</span> <span class="n">dervinism</span><span class="o">/</span><span class="n">icephys_mock_repo</span>
<span class="n">cd</span> <span class="n">icephys_mock_repo</span>
<span class="n">gin</span> <span class="n">get</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
<p>This is part of the real intracellular electrophysiology recording data. The data has been recorded in pyramidal cells in the CA1 region of the hippocampus in vitro. AMPA and NMDA receptors were blocked using NBQX and AP5, respectively. During the recording a stimulating electrode was also placed in the pyramidal layer of the hippocampus roughly 100 um away from the recording site. In addition to the electrical stimulation, optogenetic stimulation was used to excite parvalbumin (PV) expressing interneurons in the pyramidal layer using channelrhodopsin. Both electrical stimulation and optogenetic stimulation were applied interchangeably every 5 seconds using two 5-millisecond light pulses or two action potentials separated by 50 milliseconds while the cell was voltage-clamped (the baseline stimulation regime). Then the cell was switched to the current clamp and the neural plasticity inducing protocal was applied. The plasticity protocol consisted of a burst of 4 action potentials paired with a 5-millisecond light pulse applied at the onset of the first action potential. The plasticity inducing stimulation was applied 100 times every 200 milliseconds. Then the cell was switched back to the voltage clamp and the baseline stimulation regime was resumed. The experiment is described in more detail in the README file.</p>
<p>The data inside the repository is organised based on recording sessions and has the following structure: <code class="docutils literal notranslate"><span class="pre">recording-session-date/brain-slice-number/cell-number</span></code>. Each recording session has a lab book file containing comments relevant for that particular recording session. Each cell recording has:</p>
<ul class="simple">
<li><p>An image of the recorded slice.</p></li>
<li><p>A CSF file containing raw trace data exported from the aquisition CED Signal software.</p></li>
<li><p>A MAT file containing exported version of the CSF file readable in Matlab. Only the traces relevant for the experiment are stored in this file.</p></li>
</ul>
</section>
<section id="set-up-your-research-data-repository">
<span id="tutorials-pclamp-setup-repo"></span><h2>Set up Your Research Data Repository<a class="headerlink" href="#set-up-your-research-data-repository" title="Permalink to this headline">#</a></h2>
<p>You should rename your repository, delete the .git folder located inside the repository root folder, and update your README file if needed. Once this is done, issue the command below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">init</span>
</pre></div>
</div>
<p>This would intialise the local repository.</p>
</section>
<section id="upload-repository">
<span id="tutorials-pclamp-upload-repo"></span><h2>Upload Repository<a class="headerlink" href="#upload-repository" title="Permalink to this headline">#</a></h2>
<p>The next step is to create a remote repository with the same name and associate it with the local repository. You can simply do it by typing in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">add</span><span class="o">-</span><span class="n">remote</span> <span class="n">your</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">name</span> <span class="n">gin</span><span class="p">:</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">/</span><span class="n">your</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">name</span> <span class="o">--</span><span class="n">default</span>
</pre></div>
</div>
<p>In this case, the remote repository is going to be created since it does not exist. You can now type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">commit</span> <span class="o">.</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Initial commit&quot;</span>
<span class="n">gin</span> <span class="n">upload</span> <span class="o">.</span>
</pre></div>
</div>
<p>The first command would record local changes with the local version control system. By doing so you create the image of your repository that can always be reverted to in the future in case the need to do so arises. When commiting local repository changes to your version control system you typically provide a concise message describing the changes. By convention, the message length should not exceed 50 characters. Dot means that the command is executed on the contents of the current working directory; therefore, make sure that you are inside the root folder of your repository when carrying out this action. The flag -m is used to pass the commit message. When you make new changes to the repository, whether editing text files or manipulating your data files, you should commit these changes periodically to your local versioning system. Finally, the <code class="docutils literal notranslate"><span class="pre">upload</span></code> command updates the remote instance of the repository with the changes that were commited locally up to this point.</p>
<p>Alternatively, you can create a repository using the GIN web interface. You do it by clicking the plus sign in the top menu and then clicking and chosing the New Repository option.</p>
<a class="reference internal image-reference" href="../_images/Fig01-create-repo11.png" id="fig-gin-pclamp-create-repo1"><img alt="../_images/Fig01-create-repo11.png" class="align-center" id="fig-gin-pclamp-create-repo1" src="../_images/Fig01-create-repo11.png" style="width: 690px;" /></a>
<p>       <strong>Figure 1. Create Repository Using Web Interface</strong></p>
<p>You should see the New Repository window where you enter the name of the repository and its description as shown below.</p>
<a class="reference internal image-reference" href="../_images/Fig02-create-repo21.png" id="fig-gin-pclamp-create-repo2"><img alt="../_images/Fig02-create-repo21.png" class="align-center" id="fig-gin-pclamp-create-repo2" src="../_images/Fig02-create-repo21.png" style="width: 690px;" /></a>
<p>       <strong>Figure 2. Enter Repository Details Using Web Interface</strong></p>
<p>Finally, you can upload files by clicking the blue Upload file button on the repository page.</p>
<a class="reference internal image-reference" href="../_images/Fig03-upload-repo1.png" id="fig-gin-pclamp-upload-repo"><img alt="../_images/Fig03-upload-repo1.png" class="align-center" id="fig-gin-pclamp-upload-repo" src="../_images/Fig03-upload-repo1.png" style="width: 690px;" /></a>
<p>       <strong>Figure 3. Upload Repository Files Using Web Interface</strong></p>
<p>The limitation of using the web interface is that every time you update your remote repository (upload files), you will be limited to uploading 100 files at a time with each file being no larger than 10 gigabytes. Therefore, it is more effecient/effective to use the command line tools which have none of these limitations.</p>
<p>When you use the web interface, you can specify the commit message title (no more than 50 characters by convention) and the commit message body (no more than 72 characters by convention).</p>
</section>
<section id="remove-content-of-your-local-research-data-repository">
<span id="tutorials-pclamp-remove-content"></span><h2>Remove Content of Your Local Research Data Repository<a class="headerlink" href="#remove-content-of-your-local-research-data-repository" title="Permalink to this headline">#</a></h2>
<p>One advantage of using GIN for your data repository mangement is that you do not need to keep duplicate repositories in order to prevent accidental detrimental changes to your main repository. One reason for that is having version control system. The other reason is that you can safely remove the content of your local repository and replace it with pointers to original files. As a result you can save space on your local hard-drive. To remove the local content, type the following line in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
<p>Local files larger than 10 megabytes should be replaced by symbolic links. In case you want to remove the content of specific files only, you can type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span> <span class="o">&lt;</span><span class="n">absolute</span> <span class="ow">or</span> <span class="n">relative</span> <span class="n">path</span> <span class="n">to</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">folder</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, to remove particular raw research data from our calcium imaging data repository, we type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span> <span class="s1">&#39;180126/Slice1/Cell1/180126 s1c1.jpg&#39;</span>
<span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span> <span class="mi">180126</span><span class="o">/</span><span class="n">Slice1</span><span class="o">/</span><span class="n">Cell1</span><span class="o">/</span><span class="mi">180126</span><span class="n">__s1c1_001</span><span class="o">.</span><span class="n">cfs</span>
</pre></div>
</div>
<p>To simply restore the file content type in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">get</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
<p>If you no longer need to work on your repository and its remote copy is up to date with the local copy, you can simply delete the local repository copy altogether. You should always be able to restore your repository and all of its contents on your local machine by executing these commands in your terminal (replace the repository path as appropriate):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">get</span> <span class="n">dervinism</span><span class="o">/</span><span class="n">icepys_mock_repo</span>
<span class="n">cd</span> <span class="n">icepys_mock_repo</span>
<span class="n">gin</span> <span class="n">get</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
</section>
<section id="convert-your-data-to-standardised-format">
<span id="tutorials-pclamp-convert2nwb"></span><h2>Convert Your Data to Standardised Format<a class="headerlink" href="#convert-your-data-to-standardised-format" title="Permalink to this headline">#</a></h2>
<p>In order to increase your research data’s adherence to the <a class="reference external" href="https://www.go-fair.org/fair-principles/">FAIR principles</a> of scientific data management and, in particular, to increase the interoperability of your data and chances of it being reused beyond its original purpose of collection, it is highly advisable to convert your data into one of the more popular standard file formats for neuroscience data. One such format is the <a class="reference external" href="https://www.nwb.org/">Neurodata Without Borders (NWB)</a> which is highly suitable for most of the neurophysiology data. Programming interfaces in both Matlab and Python are available for converting your data. Here we are going to provide explanations of how you can convert your data in both programming languages. While showing you examples of that, we will continue our focus on the intracellular electrophysiology data.</p>
<section id="convert-to-nwb-using-matlab">
<span id="tutorials-pclamp-convert2nwb-matlab"></span><h3>Convert to NWB Using Matlab<a class="headerlink" href="#convert-to-nwb-using-matlab" title="Permalink to this headline">#</a></h3>
<section id="install-matnwb-toolbox">
<span id="tutorials-pclamp-convert2nwb-matlab-install-matnwb"></span><h4>Install MatNWB Toolbox<a class="headerlink" href="#install-matnwb-toolbox" title="Permalink to this headline">#</a></h4>
<p>To begin with the Matlab demonstration, you would need to install <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/">MatNWB toolbox</a>. To download the toolbox, type in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">NeurodataWithoutBorders</span><span class="o">/</span><span class="n">matnwb</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Move the downloaded repository to the folder where you keep your code libraries. Then type the following in the Matlab command line:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="n">matnwb</span><span class="w"></span>
<span class="nb">addpath</span><span class="p">(</span><span class="nb">genpath</span><span class="p">(</span><span class="nb">pwd</span><span class="p">));</span><span class="w"></span>
<span class="n">generateCore</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>You can now start using MatNWB. MatNWB interface documentation can be accessed <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/index.html">here</a>.</p>
</section>
<section id="record-metadata">
<span id="tutorials-pclamp-convert2nwb-matlab-record-metadata"></span><h4>Record Metadata<a class="headerlink" href="#record-metadata" title="Permalink to this headline">#</a></h4>
<p>Inside the intracellular electrophysiology repository there is a folder with the Matlab file that you can execute in order to convert the data of one particular imaging/recording session into the NWB format. The script is located inside the <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126/nwb</span></code> folder in the file named <code class="docutils literal notranslate"><span class="pre">convert2nwbpClamp.m</span></code> and, if executed, it would convert the data stored in the file <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126__s1c1_001_ED.mat</span></code>.</p>
<p>Initially, we start by recording the metadata associated with this experimental session. In this tutorial the metadata is divided into three types: Project, animal, and session metadata. The project metadata is common to all animals and experimental sessions and is defined by the part of the script below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">projectName</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Inhibitory plasticity experiment in CA1&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">experimenter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;MU&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">institution</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;University of Bristol&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">publications</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;In preparation&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">lab</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Jack Mellor lab&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">brainArea</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Hippocampus CA1&#39;</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The names of most of these parameters are self-explanatory. Next we define animal metadata. The reason to have this type of data separate is that multiple slices can be obtained from the same animal and used in separate recording sessions. The animal metadata is defined in the code snippet below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">animalID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;180126&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">ageInDays</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">34</span><span class="p">;</span><span class="w"></span>
<span class="n">age</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;P&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">ageInDays</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;D&#39;</span><span class="p">];</span><span class="w"> </span><span class="c">% Convert to ISO8601 format: https://en.wikipedia.org/wiki/ISO_8601#Durations</span><span class="w"></span>
<span class="n">strain</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Ai32/PVcre&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">sex</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;F&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">species</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Mus musculus&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">weight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;001&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">% Animal testing order.</span><span class="w"></span>
</pre></div>
</div>
<p>Names of these parameters are again self-explanatory. Finally, we define the subject level metadata in the code below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">startYear</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2018</span><span class="p">;</span><span class="w"></span>
<span class="n">startMonth</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">startDay</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">26</span><span class="p">;</span><span class="w"></span>
<span class="n">startTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">datetime</span><span class="p">(</span><span class="n">startYear</span><span class="p">,</span><span class="w"> </span><span class="n">startMonth</span><span class="p">,</span><span class="w"> </span><span class="n">startDay</span><span class="p">);</span><span class="w"></span>
<span class="nb">year</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">startYear</span><span class="p">);</span><span class="w"> </span><span class="nb">year</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">year</span><span class="p">(</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
<span class="nb">month</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">startMonth</span><span class="p">);</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="nb">month</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nb">month</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;0&#39;</span><span class="w"> </span><span class="nb">month</span><span class="p">];</span><span class="w"> </span><span class="k">end</span><span class="w"></span>
<span class="nb">day</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">startDay</span><span class="p">);</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="nb">day</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nb">day</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;0&#39;</span><span class="w"> </span><span class="nb">day</span><span class="p">];</span><span class="w"> </span><span class="k">end</span><span class="w"></span>
<span class="n">sliceNumber</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">cellNumber</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">sessionID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="nb">year</span><span class="w"> </span><span class="nb">month</span><span class="w"> </span><span class="nb">day</span><span class="w"> </span><span class="s">&#39;__s&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;c&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)];</span><span class="w"> </span><span class="c">% mouse-id_time_slice-id_cell-id</span><span class="w"></span>
<span class="n">sessionDescription</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Current and voltage clamp recordings using electric/optogenetic stimulation plasticity-inducing protocol.&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">expDescription</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Optogenetic and current stim pathways were stimulated in an interleaved fashion with a 5 second interval.&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                  </span><span class="s">&#39;Each stimulation pathway consisted of 2 stimulations at 50ms interval: 2 action potentials or 2 light pulses.&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                  </span><span class="s">&#39;After stable baselines in both pathways, plasticity protocol was induced.&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                  </span><span class="s">&#39;After plasticty protocol induced, optogenetic and current stimulation resumed as before.&#39;</span><span class="p">];</span><span class="w"></span>
<span class="n">sessionNotes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;180126 PV mouse&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Gender: female&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;DOB: 23/12/17 – 4/5wo&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;genotype: ??&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;ID: 065321 l0 r1&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;in NBQX and AP5&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;NEW  protocol using soph&#39;&#39;s&#39;</span><span class="w"> </span><span class="k">...</span><span class="c"> </span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;0ms gap single pre 4 post spikes with 0ms interval between the pre and 1st post&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Slice 1&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Cell1&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                </span><span class="s">&#39;Ok cell died within around 20 mins&#39;</span><span class="p">];</span><span class="w"></span>
</pre></div>
</div>
<p>Again, these variables are mostly self-explanatory or commented in the code. The <code class="docutils literal notranslate"><span class="pre">sessionNotes</span></code> variable is coming from the <code class="docutils literal notranslate"><span class="pre">180126/180126</span> <span class="pre">lab</span> <span class="pre">book.docx.docx</span></code> file.</p>
<p>The way you define your metadata may be different. For example, you may have your own custom scripts that contain the metadata or you may store your metadata in files organised according to one of standard neuroscientific metadata formats like <a class="reference external" href="http://g-node.github.io/python-odml/">odML</a>. Whichever your preference is, this part of the NWB conversion procedure will vary depending on the individual researcher.</p>
<p>The initialisation process is completed by intialising the Matlab NWB classes by calling</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">generateCore</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>We start the conversion process by creating an <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/NwbFile.html"><code class="docutils literal notranslate"><span class="pre">NWBFile</span></code></a> object and defining session metadata:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Assign NWB file fields</span><span class="w"></span>
<span class="n">nwb</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NwbFile</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;session_description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionDescription</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;identifier&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionID</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;session_start_time&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_experimenter&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">experimenter</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % optional</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_session_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionID</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % optional</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_institution&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">institution</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % optional</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_related_publications&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">publications</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % optional</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_notes&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sessionNotes</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % optional</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_lab&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">lab</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;general_experiment_description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">expDescription</span><span class="p">);</span><span class="w"> </span><span class="c">% optional</span><span class="w"></span>
</pre></div>
</div>
<p>Each file must have a <code class="docutils literal notranslate"><span class="pre">session_description</span></code> identifier and a <code class="docutils literal notranslate"><span class="pre">session_start_time</span></code> parameter. We then initialise the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/Subject.html"><code class="docutils literal notranslate"><span class="pre">Subject</span></code></a> object and the metadata it contains:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Create subject object</span><span class="w"></span>
<span class="n">subject</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Subject</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;subject_id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">animalID</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;age&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;species&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;sex&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="p">);</span><span class="w"></span>
<span class="n">nwb</span><span class="p">.</span><span class="n">general_subject</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">subject</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="load-patch-clamp-recording-data">
<span id="tutorials-pclamp-convert2nwb-matlab-load-data"></span><h4>Load Patch Clamp Recording Data<a class="headerlink" href="#load-patch-clamp-recording-data" title="Permalink to this headline">#</a></h4>
<p>The next part of the conversion script loads aggregated and preprocessed data stored inside the <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126__s1c1_001_ED.mat</span></code> file:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">load</span><span class="p">([</span><span class="s">&#39;..\&#39;</span><span class="w"> </span><span class="nb">year</span><span class="w"> </span><span class="nb">month</span><span class="w"> </span><span class="nb">day</span><span class="w"> </span><span class="s">&#39;__s&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;c&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;_001_ED.mat&#39;</span><span class="p">]);</span><span class="w"></span>
<span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">data</span><span class="p">.([</span><span class="s">&#39;V&#39;</span><span class="w"> </span><span class="nb">year</span><span class="w"> </span><span class="nb">month</span><span class="w"> </span><span class="nb">day</span><span class="w"> </span><span class="s">&#39;__s&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;c&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;_001_wave_data&#39;</span><span class="p">]);</span><span class="w"></span>
<span class="n">data</span><span class="p">.</span><span class="n">values</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">values</span><span class="p">)</span><span class="o">&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">vcScaleFactor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="mf">10E12</span><span class="p">;</span><span class="w"></span>
<span class="n">ccScaleFactor</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.5</span><span class="o">/</span><span class="mf">10E5</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>The data contains both voltage and current clamp recordings obtained in a pyramidal cell located in the hippocampal CA1 region while inhibitory cells in the vicinity are being stimulated by direct current, or optogenitically, or both. The table below describes variables inside the file.</p>
<table class="colwidths-auto table" id="tutorials-pclamp-convert2nwb-matlab-variable-table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Variable</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>xlabel</p></td>
<td><p><em>The x-axis label.</em></p></td>
</tr>
<tr class="row-odd"><td><p>xunits</p></td>
<td><p><em>The x-axis units.</em></p></td>
</tr>
<tr class="row-even"><td><p>start</p></td>
<td><p><em>Recording start time (seconds).</em></p></td>
</tr>
<tr class="row-odd"><td><p>interval</p></td>
<td><p><em>Sampling interval (seconds).</em></p></td>
</tr>
<tr class="row-even"><td><p>points</p></td>
<td><p><em>Data points per sweep.</em></p></td>
</tr>
<tr class="row-odd"><td><p>chans</p></td>
<td><p><em>Number of recording channels.</em></p></td>
</tr>
<tr class="row-even"><td><p>frames</p></td>
<td><p><em>Total number of recording sweeps.</em></p></td>
</tr>
<tr class="row-odd"><td><p>chaninfo</p></td>
<td><p><em>A Matlab structure storing information about the recording channel.</em></p></td>
</tr>
<tr class="row-even"><td><p>frameinfo</p></td>
<td><p><em>A Matlab structure storing information about each recording sweep.</em></p></td>
</tr>
<tr class="row-odd"><td><p>values</p></td>
<td><p><em>Recorded data values in the form of current (voltage clamp) or voltage (current clamp).</em></p></td>
</tr>
</tbody>
</table>
<p><strong>Table 1. Preprocessed Data</strong></p>
<p>The two critical variables are <code class="docutils literal notranslate"><span class="pre">frameinfo</span></code> and <code class="docutils literal notranslate"><span class="pre">values</span></code>. The latter is a data matrix with one dimension corresponding to time and the other to the sweep number. <code class="docutils literal notranslate"><span class="pre">frameinfo</span></code> is further organised on the sweep basis and data columns with the following labels:</p>
<table class="colwidths-auto table" id="tutorials-pclamp-convert2nwb-matlab-sweep-table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Label</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>number</p></td>
<td><p><em>The recording sweep number ID.</em></p></td>
</tr>
<tr class="row-odd"><td><p>points</p></td>
<td><p><em>Real (non-zero) data samples per sweep.</em></p></td>
</tr>
<tr class="row-even"><td><p>start</p></td>
<td><p><em>Sweep start time relative to the start of the entire recording (seconds).</em></p></td>
</tr>
<tr class="row-odd"><td><p>state</p></td>
<td><p><em>The experimental state ID: 0 (light stimulation during the baseline condition), 1 (current stimulation during the baseline condition), 2 (inhibitory synaptic plasticity induction condition), 9 (break between baseline and plasticity induction conditions).</em></p></td>
</tr>
<tr class="row-even"><td><p>tag</p></td>
<td><p><em>Sweep tag (unused).</em></p></td>
</tr>
<tr class="row-odd"><td><p>sweeps</p></td>
<td><p><em>Number of sweeps (0 as sweeps are called frames instead).</em></p></td>
</tr>
<tr class="row-even"><td><p>label</p></td>
<td><p><em>Experimental condition label (similar to <code class="docutils literal notranslate"><span class="pre">state</span></code>).</em></p></td>
</tr>
</tbody>
</table>
<p><strong>Table 2. Column Labels of <code class="docutils literal notranslate"><span class="pre">frameinfo</span></code> variable</strong></p>
<p>We are interested in specific columns: <code class="docutils literal notranslate"><span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">points</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, and <code class="docutils literal notranslate"><span class="pre">label</span></code> and are going to work with these variables during the tutorial.</p>
<p>We also initialise <code class="docutils literal notranslate"><span class="pre">vcScaleFactor</span></code> and <code class="docutils literal notranslate"><span class="pre">ccScaleFactor</span></code> variables used to convert data into SI units for membrane potential and current: volts and amperes, respectively.</p>
<p>After loading the data, we extract relevant info:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Extract sweep and run data</span><span class="w"></span>
<span class="n">sweepIDs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="p">.</span><span class="n">number</span><span class="p">,</span><span class="n">data</span><span class="p">.</span><span class="n">frameinfo</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">));</span><span class="w"> </span><span class="c">% Apply function to each array element</span><span class="w"></span>
<span class="w">                                                                              </span><span class="c">% and output in uniform array</span><span class="w"></span>
<span class="n">sweepDataPoints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">double</span><span class="p">(</span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="p">.</span><span class="n">points</span><span class="p">,</span><span class="n">data</span><span class="p">.</span><span class="n">frameinfo</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">));</span><span class="w"></span>
<span class="n">sweepStartTimes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">double</span><span class="p">(</span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="p">.</span><span class="n">start</span><span class="p">,</span><span class="n">data</span><span class="p">.</span><span class="n">frameinfo</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">));</span><span class="w"></span>
<span class="n">sweepStates</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">double</span><span class="p">(</span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="p">.</span><span class="n">state</span><span class="p">,</span><span class="n">data</span><span class="p">.</span><span class="n">frameinfo</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="nb">true</span><span class="p">));</span><span class="w"></span>
<span class="n">sweepLabels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">x</span><span class="p">)</span><span class="n">x</span><span class="p">.</span><span class="n">label</span><span class="p">,</span><span class="n">data</span><span class="p">.</span><span class="n">frameinfo</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="nb">false</span><span class="p">);</span><span class="w"></span>
<span class="p">[</span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="n">runInds</span><span class="p">,</span><span class="w"> </span><span class="n">runStartTimes</span><span class="p">,</span><span class="w"> </span><span class="n">runDataPoints</span><span class="p">,</span><span class="w"> </span><span class="n">runUnits</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getRuns</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">,</span><span class="w"> </span><span class="n">sweepDataPoints</span><span class="p">,</span><span class="w"> </span><span class="n">sweepStartTimes</span><span class="p">);</span><span class="w"></span>
<span class="n">nSweeps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">sweepIDs</span><span class="p">);</span><span class="w"> </span><span class="c">% Total number of sweeps</span><span class="w"></span>
<span class="n">nRuns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">runs</span><span class="p">);</span><span class="w"> </span><span class="c">% Total number of runs</span><span class="w"></span>
<span class="n">runInds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">runInds</span><span class="o">&#39;</span><span class="w"> </span><span class="p">[</span><span class="n">runInds</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">)</span><span class="o">&#39;-</span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">nSweeps</span><span class="p">]];</span><span class="w"></span>
</pre></div>
</div>
<p>All recording sweeps comprise five runs based on stimulus repetitions. Sweep IDs 139-198 are the first baseline condition with alternating light and current stimulation, followed by the 3-sweep long break period with no stimulation (IDs 199-201), and then followed by the inhibitory plasticity induction run of 10 longer sweeps with simultaneous light and current stimulation (IDs 202-211). The plasticity run is then followed by the second break period (IDs 212 and 213) and by the sebsequent second baseline stimulation run (IDs 214-435). 5 corresponding run labels, start sweep indices, run start times, data points per sweep, and run units are extracted by calling the local <code class="docutils literal notranslate"><span class="pre">getRuns</span></code> function:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">runs</span><span class="p">,</span><span class="w"> </span><span class="n">runInds</span><span class="p">,</span><span class="w"> </span><span class="n">runStartTimes</span><span class="p">,</span><span class="w"> </span><span class="n">runDataPoints</span><span class="p">,</span><span class="w"> </span><span class="n">runUnits</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getRuns</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">,</span><span class="w"> </span><span class="n">sweepDataPoints</span><span class="p">,</span><span class="w"> </span><span class="n">sweepStartTimes</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The function code is given below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">...</span><span class="w"></span>
<span class="n">runs</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;baseline&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">inds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">dataPoints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sweepDataPoints</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">startTimes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sweepStartTimes</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">sweepUnits</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;amperes&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">units</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sweepUnits</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">sweep</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="nb">numel</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">{</span><span class="n">sweep</span><span class="p">}(</span><span class="mi">1</span><span class="p">),</span><span class="n">sweepLabels</span><span class="p">{</span><span class="n">sweep</span><span class="o">-</span><span class="mi">1</span><span class="p">}(</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">{</span><span class="n">sweep</span><span class="p">}(</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;b&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">runs</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;break&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">%#ok&lt;*AGROW&gt;</span><span class="w"></span>
<span class="w">      </span><span class="n">units</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;amperes&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">{</span><span class="n">sweep</span><span class="p">}(</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;0&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">runs</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;plasticity&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">units</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;volts&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">{</span><span class="n">sweep</span><span class="p">}(</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">runs</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;baseline&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">units</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">units</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;amperes&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="n">inds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">inds</span><span class="w"> </span><span class="n">sweep</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="n">dataPoints</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">dataPoints</span><span class="w"> </span><span class="n">sweepDataPoints</span><span class="p">(</span><span class="n">sweep</span><span class="p">)];</span><span class="w"></span>
<span class="w">    </span><span class="n">startTimes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">startTimes</span><span class="w"> </span><span class="n">sweepStartTimes</span><span class="p">(</span><span class="n">sweep</span><span class="p">)];</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>We need information about runs because we are going to organise data hierarchically based on the stimulation protocol, runs of repeated stimulation protocols (repetitions), and groups of runs (or experimental conditions, in other words).</p>
</section>
<section id="convert-intracellular-electrophysiology-recording-data">
<span id="tutorials-pclamp-convert2nwb-matlab-convert-icephys"></span><h4>Convert Intracellular Electrophysiology Recording Data<a class="headerlink" href="#convert-intracellular-electrophysiology-recording-data" title="Permalink to this headline">#</a></h4>
<p>We start data conversion by creating the electrode object and providing a few metadata entries about the recording setup. First, we create the recording device Amplifier_Multiclamp_700A of the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/Device.html"><code class="docutils literal notranslate"><span class="pre">Device</span></code></a> class type:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>#<span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">recording</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">object</span><span class="w"></span>
<span class="n">device</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Device</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Amplifier for recording intracellular data.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;manufacturer&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Molecular Devices&#39;</span><span class="p">);</span><span class="w"></span>
<span class="n">nwb</span><span class="p">.</span><span class="n">general_devices</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;Amplifier_Multiclamp_700A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">device</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Second, we connect the amplifier to the recording electrode when we create the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/IntracellularElectrode.html"><code class="docutils literal notranslate"><span class="pre">IntracellularElectrode</span></code></a> object:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">electrode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">IntracellularElectrode</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A patch clamp electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;location&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Cell soma in CA1 of hippocampus&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;slice&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;slice #&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)],</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;device&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="n">device</span><span class="p">));</span><span class="w"></span>
<span class="n">nwb</span><span class="p">.</span><span class="n">general_intracellular_ephys</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;icephys_electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">electrode</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>The actual data conversion occurs when we specify and store <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/CurrentClampStimulusSeries.html"><code class="docutils literal notranslate"><span class="pre">CurrentClampStimulusSeries</span></code></a>, <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/CurrentClampSeries.html"><code class="docutils literal notranslate"><span class="pre">CurrentClampSeries</span></code></a>, <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/VoltageClampStimulusSeries.html"><code class="docutils literal notranslate"><span class="pre">VoltageClampStimulusSeries</span></code></a>, and <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/VoltageClampSeries.html"><code class="docutils literal notranslate"><span class="pre">VoltageClampSeries</span></code></a> objects. These are subclasses of the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/PatchClampSeries.html"><code class="docutils literal notranslate"><span class="pre">PatchClampSeries</span></code></a> class that are specifically adapted to store current clamp and voltage clamp (responses) data and associated stimulation time series data (stimuli). When creating these objects you are required to specify the <code class="docutils literal notranslate"><span class="pre">data</span></code> property which typically would be a single recording sweep with the first dimension corresponding to time. It is also useful to provide the <code class="docutils literal notranslate"><span class="pre">description</span></code> of the data, describe the stimulus using <code class="docutils literal notranslate"><span class="pre">stimulus_description</span></code> property, provide <code class="docutils literal notranslate"><span class="pre">data_continuity</span></code> property specifying if the data is continuous, instantaneous, or step-like, specify <code class="docutils literal notranslate"><span class="pre">data_unit</span></code>, provide time info by speficying <code class="docutils literal notranslate"><span class="pre">starting_time</span></code> and <code class="docutils literal notranslate"><span class="pre">starting_time_rate</span></code> properties, and link the data to the <code class="docutils literal notranslate"><span class="pre">electrode</span></code> using the <code class="docutils literal notranslate"><span class="pre">SoftLink</span></code> function. The code that creates stimulus and data series objects is given below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Add current and voltage clamp data</span><span class="w"></span>
<span class="n">stimulusObjectViews</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">responseObjectViews</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">sweep</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">nSweeps</span><span class="w"></span>
<span class="w">  </span><span class="nb">run</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">runInds</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">sweep</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">sweep</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">runInds</span><span class="p">(:,</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">values</span><span class="p">(</span><span class="n">sweep</span><span class="p">,:);</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">samplingRate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="o">/</span><span class="n">data</span><span class="p">.</span><span class="n">interval</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">startTime</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sweepStartTimes</span><span class="p">(</span><span class="n">sweep</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">electrode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">electrode</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">stimState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sweepStates</span><span class="p">(</span><span class="n">sweep</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">unit</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">runUnits</span><span class="p">{</span><span class="nb">run</span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="nb">input</span><span class="p">.</span><span class="n">condition</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">runs</span><span class="p">{</span><span class="nb">run</span><span class="p">};</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">runs</span><span class="p">{</span><span class="nb">run</span><span class="p">},</span><span class="w"> </span><span class="s">&#39;plasticity&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="o">*</span><span class="n">ccScaleFactor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">stimulusObject</span><span class="p">,</span><span class="w"> </span><span class="n">responseObject</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">setCClampSeries</span><span class="p">(</span><span class="nb">input</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">nwb</span><span class="p">.</span><span class="n">stimulus_presentation</span><span class="p">.</span><span class="n">set</span><span class="p">([</span><span class="s">&#39;CurrentClampStimulusSeries&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="nb">num2str</span><span class="p">(</span><span class="nb">run</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">runs</span><span class="p">{</span><span class="nb">run</span><span class="p">}</span><span class="w"> </span><span class="s">&#39;_sweep&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sweepIDs</span><span class="p">(</span><span class="n">sweep</span><span class="p">))],</span><span class="w"> </span><span class="n">stimulusObject</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">nwb</span><span class="p">.</span><span class="n">acquisition</span><span class="p">.</span><span class="n">set</span><span class="p">([</span><span class="s">&#39;CurrentClampSeries&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="nb">num2str</span><span class="p">(</span><span class="nb">run</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">runs</span><span class="p">{</span><span class="nb">run</span><span class="p">}</span><span class="w"> </span><span class="s">&#39;_sweep&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sweepIDs</span><span class="p">(</span><span class="n">sweep</span><span class="p">))],</span><span class="w"> </span><span class="n">responseObject</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="o">*</span><span class="n">vcScaleFactor</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">stimulusObject</span><span class="p">,</span><span class="w"> </span><span class="n">responseObject</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">setVClampSeries</span><span class="p">(</span><span class="nb">input</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">nwb</span><span class="p">.</span><span class="n">stimulus_presentation</span><span class="p">.</span><span class="n">set</span><span class="p">([</span><span class="s">&#39;VoltageClampStimulusSeries&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="nb">num2str</span><span class="p">(</span><span class="nb">run</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">runs</span><span class="p">{</span><span class="nb">run</span><span class="p">}</span><span class="w"> </span><span class="s">&#39;_sweep&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sweepIDs</span><span class="p">(</span><span class="n">sweep</span><span class="p">))],</span><span class="w"> </span><span class="n">stimulusObject</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">nwb</span><span class="p">.</span><span class="n">acquisition</span><span class="p">.</span><span class="n">set</span><span class="p">([</span><span class="s">&#39;VoltageClampSeries&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="nb">num2str</span><span class="p">(</span><span class="nb">run</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;_&#39;</span><span class="w"> </span><span class="n">runs</span><span class="p">{</span><span class="nb">run</span><span class="p">}</span><span class="w"> </span><span class="s">&#39;_sweep&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sweepIDs</span><span class="p">(</span><span class="n">sweep</span><span class="p">))],</span><span class="w"> </span><span class="n">responseObject</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="n">stimulusObjectViews</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">stimulusObjectViews</span><span class="p">;</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">ObjectView</span><span class="p">(</span><span class="n">stimulusObject</span><span class="p">)];</span><span class="w"></span>
<span class="w">  </span><span class="n">responseObjectViews</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">responseObjectViews</span><span class="p">;</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">ObjectView</span><span class="p">(</span><span class="n">responseObject</span><span class="p">)];</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>It packages the needed parameters for setting up these time series objects inside the <code class="docutils literal notranslate"><span class="pre">input</span></code> structure and passes them into local <code class="docutils literal notranslate"><span class="pre">setCClampSeries</span></code> and <code class="docutils literal notranslate"><span class="pre">setVClampSeries</span></code> functions which do the required job. They output stimulus and response objects which are then stored inside <code class="docutils literal notranslate"><span class="pre">stimulus_presentation</span></code> and <code class="docutils literal notranslate"><span class="pre">acquisition</span></code> containers of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object. In addition, we also store links to these objects using the <code class="docutils literal notranslate"><span class="pre">ObjectView</span></code> function, so that we can annotate these time series objects and organise them hierarchically. The code for <code class="docutils literal notranslate"><span class="pre">setCClampSeries</span></code> function is given below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">...</span><span class="w"></span>
<span class="n">CCSS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">CurrentClampStimulusSeries</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Plasticity condition&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_continuity&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;continuous&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_unit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;amperes&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;gain&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time_rate&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">samplingRate</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">electrode</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;stimulus_description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Plasticity protocol: Simultaneous current and light stimulation&#39;</span><span class="p">);</span><span class="w"></span>

<span class="n">CCS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">CurrentClampSeries</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Plasticity condition&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_continuity&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;continuous&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_unit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;gain&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time_rate&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">samplingRate</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">electrode</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;stimulus_description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Plasticity protocol: Simultaneous current and light stimulation&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>and the code for <code class="docutils literal notranslate"><span class="pre">setVClampSeries</span></code> function is given here:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">...</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;baseline&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">stimState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Baseline condition: Light stimulation&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">stimDescription</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Baseline stimulation: Double light pulses.&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">elseif</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">stimState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Baseline condition: Current stimulation&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">stimDescription</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Baseline stimulation: Double current pulses.&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;break&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="n">description</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;Break sweeps are used while switching between two conditions: Nothing happens.&#39;</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">stimDescription</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;No stimulation.&#39;</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">VCSS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">VoltageClampStimulusSeries</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_continuity&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;continuous&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_unit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;volts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;gain&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time_rate&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">samplingRate</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">electrode</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;stimulus_description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stimDescription</span><span class="p">);</span><span class="w"></span>

<span class="n">VCS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">VoltageClampSeries</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">data</span><span class="o">&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_continuity&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;continuous&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data_unit&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;gain&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">startTime</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;starting_time_rate&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">samplingRate</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="n">electrode</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;stimulus_description&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stimDescription</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>We use the same data for stimuli and responses as stimuli data has not been recorded. Later when creating recordings table we are going to indicate that stimulation data does not really exist.</p>
</section>
<section id="create-intracellular-recordings-table">
<span id="tutorials-pclamp-convert2nwb-matlab-recordings-table"></span><h4>Create Intracellular Recordings Table<a class="headerlink" href="#create-intracellular-recordings-table" title="Permalink to this headline">#</a></h4>
<p>It is useful to group stimuli and responses together, as well as associate them with important metadata. By doing so we make it easier to access these time series objects based on their metadata properties and appropriately process and analyse them collectively as required. The <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/IntracellularRecordingsTable.html"><code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code></a> class allows to do just that. It is a subclass of <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+hdmf_common/AlignedDynamicTable.html"><code class="docutils literal notranslate"><span class="pre">AlignedDynamicTable</span></code></a> class that can group multiple objects of <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+hdmf_common/DynamicTable.html"><code class="docutils literal notranslate"><span class="pre">DynamicTable</span></code></a> type. In the case of intracellular recordings, it groups together electrode metadata (<a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/IntracellularElectrodesTable.html"><code class="docutils literal notranslate"><span class="pre">IntracellularElectrodesTable</span></code></a>), with stimuli (<a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/IntracellularStimuliTable.html"><code class="docutils literal notranslate"><span class="pre">IntracellularStimuliTable</span></code></a>), responses (<a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/IntracellularResponsesTable.html"><code class="docutils literal notranslate"><span class="pre">IntracellularResponsesTable</span></code></a>), and any other custom metadata. We start by creating <code class="docutils literal notranslate"><span class="pre">IntracellularElectrodesTable</span></code>:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Create intracellular recording table</span><span class="w"></span>
<span class="n">icRecTable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">IntracellularRecordingsTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;categories&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;electrodes&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;stimuli&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;responses&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;order&#39;</span><span class="p">,</span><span class="s">&#39;points&#39;</span><span class="p">,</span><span class="s">&#39;start&#39;</span><span class="p">,</span><span class="s">&#39;state&#39;</span><span class="p">,</span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="s">&#39;electrode&#39;</span><span class="p">,</span><span class="s">&#39;stimulus&#39;</span><span class="p">,</span><span class="s">&#39;response&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;A table to group together a stimulus and response from a single &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;electrode and a single simultaneous recording and for storing &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;metadata about the intracellular recording.&#39;</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
<p>and then defining its required fields as in the example below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">icRecTable</span><span class="p">.</span><span class="n">electrodes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">IntracellularElectrodesTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Table for storing intracellular electrode related metadata.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;electrode&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepIDs</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;electrode&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">repmat</span><span class="p">(</span><span class="n">types</span><span class="p">.</span><span class="n">untyped</span><span class="p">.</span><span class="n">ObjectView</span><span class="p">(</span><span class="n">electrode</span><span class="p">),</span><span class="w"> </span><span class="n">nSweeps</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Column for storing the reference to the intracellular electrode&#39;</span><span class="p">));</span><span class="w"></span>

<span class="n">icRecTable</span><span class="p">.</span><span class="n">stimuli</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">IntracellularStimuliTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Table for storing intracellular stimulus related data and metadata.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;stimulus&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepIDs</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;stimulus&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">TimeSeriesReferenceVectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Column storing the reference to the recorded stimulus for the recording (rows)&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;idx_start&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nSweeps</span><span class="p">)</span><span class="o">.*-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Start index in time for the timeseries</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;count&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nSweeps</span><span class="p">)</span><span class="o">.*-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Number of timesteps to be selected starting from idx_start</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;timeseries&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stimulusObjectViews</span><span class="p">)));</span><span class="w"></span>

<span class="n">icRecTable</span><span class="p">.</span><span class="n">responses</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">IntracellularResponsesTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Table for storing intracellular response related data and metadata.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;response&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepIDs</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;response&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">TimeSeriesReferenceVectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Column storing the reference to the recorded response for the recording (rows)&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">struct</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;idx_start&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nSweeps</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;count&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepDataPoints</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;timeseries&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">responseObjectViews</span><span class="p">)));</span><span class="w"></span>
</pre></div>
</div>
<p>By passing in an array of -1 as <code class="docutils literal notranslate"><span class="pre">idx_start</span></code> and <code class="docutils literal notranslate"><span class="pre">count</span></code> when creating the <code class="docutils literal notranslate"><span class="pre">IntracellularStimuliTable</span></code> object, we indicate that stimulation data does not exist and only the response data should be stored. All the above three subtables must have the same number of rows.</p>
<p>As mentioned earlier, <code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code> can contain additional custom fields or categories. This allows us to group sweep metadata info into a single table and associate this metadata to corresponding recording sweep data. Additional metadata columns that we add to the recordings table include <code class="docutils literal notranslate"><span class="pre">order</span></code>, <code class="docutils literal notranslate"><span class="pre">points</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, and <code class="docutils literal notranslate"><span class="pre">label</span></code>:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Add the sweep metadata category to the intracellular recording table</span><span class="w"></span>
<span class="n">icRecTable</span><span class="p">.</span><span class="n">categories</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">icRecTable</span><span class="p">.</span><span class="n">categories</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;sweeps&#39;</span><span class="p">}];</span><span class="w"></span>
<span class="n">icRecTable</span><span class="p">.</span><span class="n">dynamictable</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;sweeps&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">DynamicTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Sweep metadata.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;order&#39;</span><span class="p">,</span><span class="s">&#39;points&#39;</span><span class="p">,</span><span class="s">&#39;start&#39;</span><span class="p">,</span><span class="s">&#39;state&#39;</span><span class="p">,</span><span class="s">&#39;label&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepIDs</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;order&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepIDs</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Recorded sweep order.&#39;</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;points&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepDataPoints</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;The number of data points within the sweep.&#39;</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;start&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepStartTimes</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;The sweep recording start time in seconds.&#39;</span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;state&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepStates</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;The experimental state ID: &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                      </span><span class="s">&#39;0 - light stimulation during the baseline condition.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                      </span><span class="s">&#39;1 - current stimulation during the baseline condition.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                      </span><span class="s">&#39;2 - inhibitory synaptic plasticity induction condition.&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">                      </span><span class="s">&#39;9 - break between baseline and plasticity induction conditions.&#39;</span><span class="p">]),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;label&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sweepLabels</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;The experimental state label.&#39;</span><span class="p">)));</span><span class="w"></span>
<span class="w"> </span>
<span class="n">nwb</span><span class="p">.</span><span class="n">general_intracellular_ephys_intracellular_recordings</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">icRecTable</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Like the predefined categories, custom categories must have the same number of rows as categories that already form the main table.</p>
</section>
<section id="group-intracellular-recording-sweeps">
<span id="tutorials-pclamp-convert2nwb-matlab-group-sweeps"></span><h4>Group Intracellular Recording Sweeps<a class="headerlink" href="#group-intracellular-recording-sweeps" title="Permalink to this headline">#</a></h4>
<p>NWB files provide a way to group intracellular recordings in a hierarchical manner. You can indicate which recordings were obtained simultaneously, if any. You can further group the simultaneous recordings into sequential recordings and runs (or repetitions). Finally you can group runs into experimental conditions. All these groupings are <code class="docutils literal notranslate"><span class="pre">DynamicTable</span></code> classes that allow adding custom metadata entries. Specifying metadata at different hierarchy levels avoids specifying this information for every recording sweep. If you decide to use these optional groupings, using a particular grouping type implies that you also use groupings of lower hierarchy.</p>
<section id="group-simultaneously-recorded-sweeps">
<span id="tutorials-pclamp-convert2nwb-matlab-group-sweeps-simultaneous"></span><h5>Group Simultaneously Recorded Sweeps<a class="headerlink" href="#group-simultaneously-recorded-sweeps" title="Permalink to this headline">#</a></h5>
<p>The data used in this tutorial have no recordings that were obtained simultaneously. Therefore, each sweep serves as the only member of individual instances of simultaneous recordings. The reason why we still have to create simultaneous recordings group to organise the sweeps is that we intend to use groupings of higher order. We use the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/SimultaneousRecordingsTable.html"><code class="docutils literal notranslate"><span class="pre">SimultaneousRecordingsTable</span></code></a> to group simultaneously acquired sweeps and the code demonstrating how to do it is shown below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Group simultaneous recordings</span><span class="w"></span>
<span class="c">% Group indices of simultaneous recordings: There are no simultaneous</span><span class="w"></span>
<span class="c">% recordings, so each sweep stands on its own</span><span class="w"></span>
<span class="n">simSweeps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="n">simSweepsTag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">iSweep</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">nSweeps</span><span class="w"></span>
<span class="w">  </span><span class="n">simSweeps</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">simSweeps</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">iSweep</span><span class="p">;</span><span class="w"> </span><span class="c">%#ok&lt;*SAGROW&gt;</span><span class="w"></span>
<span class="w">  </span><span class="n">simSweepsTag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">simSweepsTag</span><span class="p">;</span><span class="w"> </span><span class="s">&#39;noSimultaneousRecs&#39;</span><span class="p">];</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% Create a simultaneous recordings table with a custom column</span><span class="w"></span>
<span class="c">% &#39;simultaneous_recording_tag&#39;</span><span class="w"></span>
<span class="p">[</span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">util</span><span class="p">.</span><span class="n">create_indexed_column</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">simSweeps</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;Column with references to one or more rows in the IntracellularRecordingsTable table&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">icRecTable</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span>
<span class="n">icSimRecsTable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">SimultaneousRecordingsTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;A table for grouping different intracellular recordings from &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;the IntracellularRecordingsTable together that were recorded &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;simultaneously from different electrodes. As no sweeps were recorded &#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;simultaneously, groupings contain only single sweeps.&#39;</span><span class="p">],</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;recordings&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;simultaneous_recording_tag&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">nSweeps</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;recordings&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;recordings_index&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;simultaneous_recording_tag&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A custom tag for simultaneous_recordings&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">simSweepsTag</span><span class="p">));</span><span class="w"></span>

<span class="n">nwb</span><span class="p">.</span><span class="n">general_intracellular_ephys_simultaneous_recordings</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">icSimRecsTable</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SimultaneousRecordingsTable</span></code> requires <code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code> data to be referenced by <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+hdmf_common/VectorIndex.html"><code class="docutils literal notranslate"><span class="pre">VectorIndex</span></code></a> and organised as <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+hdmf_common/VectorData.html"><code class="docutils literal notranslate"><span class="pre">VectorData</span></code></a>. This is achieved by <code class="docutils literal notranslate"><span class="pre">create_indexed_column</span></code> utility function. <code class="docutils literal notranslate"><span class="pre">recVectorData</span></code> and <code class="docutils literal notranslate"><span class="pre">recVectorInd</span></code> objects can then be fed into the <code class="docutils literal notranslate"><span class="pre">SimultaneousRecordingsTable</span></code> function together with the simultaneous sweep tag array used to form a custom <code class="docutils literal notranslate"><span class="pre">simultaneous_recording_tag</span></code> column.</p>
</section>
<section id="group-sequentially-recorded-sweeps">
<span id="tutorials-pclamp-convert2nwb-matlab-group-sweeps-sequential"></span><h5>Group Sequentially Recorded Sweeps<a class="headerlink" href="#group-sequentially-recorded-sweeps" title="Permalink to this headline">#</a></h5>
<p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/SequentialRecordingsTable.html"><code class="docutils literal notranslate"><span class="pre">SequentialRecordingsTable</span></code></a> is the next level in the groupings hierarchy. We use it to group sweeps that have the same stimulation protocol within individual runs. To begin, we create groups of simultaneous recordings indices <code class="docutils literal notranslate"><span class="pre">seqSweeps</span></code> and <code class="docutils literal notranslate"><span class="pre">stimulusType</span></code> labels corresponding to these groups. The code demonstrating how to do it is below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Group indices of sequential recordings</span><span class="w"></span>
<span class="n">seqSweeps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="n">stimulusType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="n">seqGroupCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">iRun</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">nRuns</span><span class="w"></span>
<span class="w">  </span><span class="n">condSweeps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nSweeps</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="n">condSweeps</span><span class="p">(</span><span class="n">runInds</span><span class="p">(</span><span class="n">iRun</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="n">runInds</span><span class="p">(</span><span class="n">iRun</span><span class="p">,</span><span class="k">end</span><span class="p">))</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">condStates</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sweepStates</span><span class="p">(</span><span class="nb">logical</span><span class="p">(</span><span class="n">condSweeps</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="n">uniqueSweepStates</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">unique</span><span class="p">(</span><span class="n">condStates</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="n">iState</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">numel</span><span class="p">(</span><span class="n">uniqueSweepStates</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">stateSweeps</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">sweepStates</span><span class="o">&#39;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">uniqueSweepStates</span><span class="p">(</span><span class="n">iState</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="o">&amp;</span><span class="w"> </span><span class="nb">logical</span><span class="p">(</span><span class="n">condSweeps</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="n">seqSweeps</span><span class="p">{</span><span class="nb">numel</span><span class="p">(</span><span class="n">seqSweeps</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">stateSweeps</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">uniqueSweepStates</span><span class="p">(</span><span class="n">iState</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">      </span><span class="n">stimulusType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">stimulusType</span><span class="p">;</span><span class="w"> </span><span class="s">&#39;light&#39;</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">uniqueSweepStates</span><span class="p">(</span><span class="n">iState</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="n">stimulusType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">stimulusType</span><span class="p">;</span><span class="w"> </span><span class="s">&#39;current&#39;</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">uniqueSweepStates</span><span class="p">(</span><span class="n">iState</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">      </span><span class="n">stimulusType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">stimulusType</span><span class="p">;</span><span class="w"> </span><span class="s">&#39;combined&#39;</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="n">uniqueSweepStates</span><span class="p">(</span><span class="n">iState</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">      </span><span class="n">stimulusType</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">stimulusType</span><span class="p">;</span><span class="w"> </span><span class="s">&#39;noStim&#39;</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="n">seqGroupCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">seqGroupCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
<p>We then index and organise <code class="docutils literal notranslate"><span class="pre">SimultaneousRecordingsTable</span></code> data <code class="docutils literal notranslate"><span class="pre">VectorIndex</span></code> and <code class="docutils literal notranslate"><span class="pre">VectorData</span></code> objects in a similar way like we did in the previous subsection:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">util</span><span class="p">.</span><span class="n">create_indexed_column</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">seqSweeps</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;Column with references to one or more rows in the SimultaneousRecordingsTable table&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">icSimRecsTable</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>These objects together with the <code class="docutils literal notranslate"><span class="pre">stimulusType</span></code> label array are then fed into the <code class="docutils literal notranslate"><span class="pre">SequentialRecordingsTable</span></code> function. The resulting <code class="docutils literal notranslate"><span class="pre">icSeqRecsTable</span></code> object is then stored inside the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">icSeqRecsTable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">SequentialRecordingsTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;A table for grouping different intracellular &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;simultaneous recordings from the SimultaneousRecordingsTable &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;together. Individual sweeps are grouped on the basis of the &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;stimulation type: Light, current, combined, or none. Sweeps are &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;grouped only if they belong to the same condition.&#39;</span><span class="p">],</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;simultaneous_recordings&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;stimulus_type&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">seqGroupCount</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;simultaneous_recordings&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;simultaneous_recordings_index&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;stimulus_type&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Column storing the type of stimulus used for the sequential recording&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stimulusType</span><span class="p">));</span><span class="w"></span>
<span class="w"> </span>
<span class="n">nwb</span><span class="p">.</span><span class="n">general_intracellular_ephys_sequential_recordings</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">icSeqRecsTable</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="group-recordings-into-runs">
<span id="tutorials-pclamp-convert2nwb-matlab-group-sweeps-repetitions"></span><h5>Group Recordings into Runs<a class="headerlink" href="#group-recordings-into-runs" title="Permalink to this headline">#</a></h5>
<p>We used stimulation type to group sweeps into 7 sequential recordings groups. We can further group these sequential recordings into runs using <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/RepetitionsTable.html"><code class="docutils literal notranslate"><span class="pre">RepetitionsTable</span></code></a> class. Typically, this class is used to group recordings with different stimuli into sequences that can be repeated. The code showing how we group 7 sequential recordings into runs is below:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Group recordings into runs</span><span class="w"></span>
<span class="c">% Group indices of individual runs</span><span class="w"></span>
<span class="n">runInds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]};</span><span class="w"></span>

<span class="c">% Create a repetitions table</span><span class="w"></span>
<span class="p">[</span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">util</span><span class="p">.</span><span class="n">create_indexed_column</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">runInds</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;Column with references to one or more rows in the SequentialRecordingsTable table&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">icSeqRecsTable</span><span class="p">);</span><span class="w"></span>

<span class="n">icRepetitionsTable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">RepetitionsTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;A table for grouping different intracellular sequential &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;recordings together. With each simultaneous recording &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;representing a particular type of stimulus, the RepetitionsTable &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;is used to group sets of stimuli applied in sequence.&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="p">],</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;sequential_recordings&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">nRuns</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;sequential_recordings&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;sequential_recordings_index&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">nwb</span><span class="p">.</span><span class="n">general_intracellular_ephys_repetitions</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">icRepetitionsTable</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="group-runs-into-experimental-conditions">
<span id="tutorials-pclamp-convert2nwb-matlab-group-sweeps-conditions"></span><h5>Group Runs into Experimental Conditions<a class="headerlink" href="#group-runs-into-experimental-conditions" title="Permalink to this headline">#</a></h5>
<p>Runs form the basis for the highest order grouping implemented by the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/ExperimentalConditionsTable.html"><code class="docutils literal notranslate"><span class="pre">ExperimentalConditionsTable</span></code></a> class. We use this class to group our runs, as well as to add the experimental conditions <code class="docutils literal notranslate"><span class="pre">tag</span></code> to the <code class="docutils literal notranslate"><span class="pre">ExperimentalConditionsTable</span></code>:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Group runs into experimental conditions</span><span class="w"></span>
<span class="c">% Group indices for different conditions</span><span class="w"></span>
<span class="n">condInds</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span><span class="w"></span>
<span class="n">condTags</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;baselineStim&#39;</span><span class="p">,</span><span class="s">&#39;noStim&#39;</span><span class="p">,</span><span class="s">&#39;plasticityInduction&#39;</span><span class="p">};</span><span class="w"></span>

<span class="c">% Create experimental conditions table</span><span class="w"></span>
<span class="p">[</span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">util</span><span class="p">.</span><span class="n">create_indexed_column</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">condInds</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;Column with references to one or more rows in the RepetitionsTable table&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="n">icRepetitionsTable</span><span class="p">);</span><span class="w"></span>
<span class="w"> </span>
<span class="n">icExpConditionsTable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">ExperimentalConditionsTable</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;A table for grouping different intracellular recording &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;repetitions together that belong to the same experimental &#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;conditions.&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="p">],</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;colnames&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;repetitions&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;tag&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;id&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">ElementIdentifiers</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="nb">numel</span><span class="p">(</span><span class="n">condInds</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="p">),</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;repetitions&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorData</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;repetitions_index&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">recVectorInd</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;tag&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">hdmf_common</span><span class="p">.</span><span class="n">VectorData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Experimental condition label&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">condTags</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="n">nwb</span><span class="p">.</span><span class="n">general_intracellular_ephys_experimental_conditions</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">icExpConditionsTable</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="add-recording-slice-image">
<span id="tutorials-pclamp-convert2nwb-matlab-add-image"></span><h4>Add Recording Slice Image<a class="headerlink" href="#add-recording-slice-image" title="Permalink to this headline">#</a></h4>
<p>During the recording the brain slice was photographed and saved as grayscale image inside <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126</span> <span class="pre">s1c1.jpg</span></code> file. We can read this image using Matlab’s <code class="docutils literal notranslate"><span class="pre">imread</span></code> function and store it inside the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/GrayscaleImage.html"><code class="docutils literal notranslate"><span class="pre">GrayscaleImage</span></code></a> object:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">sliceImage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">imread</span><span class="p">([</span><span class="s">&#39;..\&#39;</span><span class="w"> </span><span class="nb">year</span><span class="w"> </span><span class="nb">month</span><span class="w"> </span><span class="nb">day</span><span class="w"> </span><span class="s">&#39; s&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;c&#39;</span><span class="w"> </span><span class="nb">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span><span class="w"> </span><span class="s">&#39;.jpg&#39;</span><span class="p">]);</span><span class="w"></span>

<span class="n">sliceImage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">GrayscaleImage</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sliceImage</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c">  % required: [height, width]</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Grayscale image of the recording slice.&#39;</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>We then add the image object to the image container object <code class="docutils literal notranslate"><span class="pre">imageCollection</span></code> using <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/Images.html"><code class="docutils literal notranslate"><span class="pre">Images</span></code></a> class and add the image container to the <code class="docutils literal notranslate"><span class="pre">acquisition</span></code> data interface of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">imageCollection</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">Images</span><span class="p">(</span><span class="w"> </span><span class="k">...</span><span class="w"></span>
<span class="w">  </span><span class="s">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;A container for slice images.&#39;</span><span class="k">...</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>
<span class="n">imageCollection</span><span class="p">.</span><span class="n">image</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;slice_image&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">sliceImage</span><span class="p">);</span><span class="w"></span>

<span class="n">nwb</span><span class="p">.</span><span class="n">acquisition</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;ImageCollection&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">imageCollection</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="save-nwb-file">
<span id="tutorials-pclamp-convert2nwb-matlab-save"></span><h4>Save NWB File<a class="headerlink" href="#save-nwb-file" title="Permalink to this headline">#</a></h4>
<p>We call the <code class="docutils literal notranslate"><span class="pre">nwbExport</span></code> function to save our data in the NWB format:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% Save the converted NWB file</span><span class="w"></span>
<span class="n">nwbExport</span><span class="p">(</span><span class="n">nwb</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">sessionID</span><span class="w"> </span><span class="s">&#39;.nwb&#39;</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="read-nwb-file">
<span id="tutorials-pclamp-convert2nwb-matlab-read"></span><h4>Read NWB File<a class="headerlink" href="#read-nwb-file" title="Permalink to this headline">#</a></h4>
</section>
<section id="validate-nwb-file">
<span id="tutorials-pclamp-convert2nwb-matlab-validate"></span><h4>Validate NWB File<a class="headerlink" href="#validate-nwb-file" title="Permalink to this headline">#</a></h4>
<p>MatNWB does not provide its own NWB file validator. However, you can validate NWB files generated using Matlab in Python. For instructions on how to do it, refer to the corresponding <a class="reference internal" href="#tutorials-pclamp-convert2nwb-py-validate"><span class="std std-ref">PyNWB validation section</span></a> of the tutorial.</p>
</section>
<section id="resources">
<span id="tutorials-pclamp-convert2nwb-matlab-resources"></span><h4>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">#</a></h4>
</section>
</section>
<section id="convert-to-nwb-using-python">
<span id="tutorials-pclamp-convert2nwb-py"></span><h3>Convert to NWB Using Python<a class="headerlink" href="#convert-to-nwb-using-python" title="Permalink to this headline">#</a></h3>
<section id="install-pynwb">
<span id="tutorials-pclamp-convert2nwb-py-install"></span><h4>Install PyNWB<a class="headerlink" href="#install-pynwb" title="Permalink to this headline">#</a></h4>
<p>To convert your extracellular electrophysiology data, you will need to install PyNWB first. To do so, type in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">pynwb</span>
</pre></div>
</div>
<p>Now you’re ready to start working with PyNWB. The full installation instructions are available <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/install_users.html">here</a>.</p>
</section>
<section id="tutorials-pclamp-convert2nwb-py-record-metadata">
<span id="id1"></span><h4>Record Metadata<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-record-metadata" title="Permalink to this headline">#</a></h4>
<p>Inside the intracellular electrophysiology repository there is a folder with the Matlab file that you can execute in order to convert the data of one particular recording session into the NWB format. The script is located inside the <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126/nwb</span></code> folder in the file named <code class="docutils literal notranslate"><span class="pre">convert2nwbpClamp.py</span></code> and, if executed, it would convert the data stored in the file <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126__s1c1_001_ED.mat</span></code>.</p>
<p>We will now analyse the conversion script in more detail. The script starts by importing general and pynwb module dependencies, as well as custom functions located inside the <code class="docutils literal notranslate"><span class="pre">localFunctions.py</span></code> module file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">pynwb</span> <span class="kn">import</span> <span class="n">NWBFile</span><span class="p">,</span> <span class="n">NWBHDF5IO</span>
<span class="kn">from</span> <span class="nn">pynwb.core</span> <span class="kn">import</span> <span class="n">DynamicTable</span><span class="p">,</span> <span class="n">VectorData</span>
<span class="kn">from</span> <span class="nn">pynwb.file</span> <span class="kn">import</span> <span class="n">Subject</span>
<span class="kn">from</span> <span class="nn">pynwb.base</span> <span class="kn">import</span> <span class="n">Images</span><span class="p">,</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">pynwb.image</span> <span class="kn">import</span> <span class="n">GrayscaleImage</span>

<span class="kn">from</span> <span class="nn">localFunctions</span> <span class="kn">import</span> <span class="n">getRuns</span><span class="p">,</span> <span class="n">setVClampSeries</span><span class="p">,</span> <span class="n">setCClampSeries</span>
</pre></div>
</div>
<p>These are not all modules that we need. Some of them are loaded inside the <code class="docutils literal notranslate"><span class="pre">localFunctions.py</span></code> module file. These additional modules include:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pynwb.icephys</span> <span class="kn">import</span> <span class="n">CurrentClampSeries</span><span class="p">,</span> <span class="n">CurrentClampStimulusSeries</span><span class="p">,</span> <span class="n">VoltageClampSeries</span><span class="p">,</span> <span class="n">VoltageClampStimulusSeries</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">Any</span>
</pre></div>
</div>
<p>We then record metadata associated with this experimental session. In this tutorial the metadata is divided into three types: Project, animal, and session metadata. The project metadata is common to all animals and experimental sessions and is defined by the part of the script below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">projectName</span> <span class="o">=</span> <span class="s1">&#39;Inhibitory plasticity experiment in CA1&#39;</span>
<span class="n">experimenter</span> <span class="o">=</span> <span class="s1">&#39;MU&#39;</span>
<span class="n">institution</span> <span class="o">=</span> <span class="s1">&#39;University of Bristol&#39;</span>
<span class="n">publications</span> <span class="o">=</span> <span class="s1">&#39;In preparation&#39;</span>
<span class="n">lab</span> <span class="o">=</span> <span class="s1">&#39;Jack Mellor lab&#39;</span>
<span class="n">brainArea</span> <span class="o">=</span> <span class="s1">&#39;Hippocampus CA1&#39;</span>
</pre></div>
</div>
<p>The names of most of these parameters are self-explanatory. Next we define animal metadata. The reason to have this type of data separate is that multiple slices can be obtained from the same animal and used in separate recording sessions. The animal metadata is defined in the code snippet below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">animalID</span> <span class="o">=</span> <span class="s1">&#39;180126&#39;</span>
<span class="n">ageInDays</span> <span class="o">=</span> <span class="mi">34</span>
<span class="n">age</span> <span class="o">=</span> <span class="s1">&#39;P&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ageInDays</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;D&#39;</span> <span class="c1"># Convert to ISO8601 format: https://en.wikipedia.org/wiki/ISO_8601#Durations</span>
<span class="n">strain</span> <span class="o">=</span> <span class="s1">&#39;Ai32/PVcre&#39;</span>
<span class="n">sex</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
<span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;Mus musculus&#39;</span>
<span class="n">weight</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;001&#39;</span> <span class="c1"># Animal testing order.</span>
</pre></div>
</div>
<p>Names of these parameters are again self-explanatory. Finally, we define the subject level metadata in the code below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">startYear</span> <span class="o">=</span> <span class="mi">2018</span>
<span class="n">startMonth</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">startDay</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">startTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">startYear</span><span class="p">,</span> <span class="n">startMonth</span><span class="p">,</span> <span class="n">startDay</span><span class="p">)</span>
<span class="n">year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">startYear</span><span class="p">);</span> <span class="n">year</span> <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">month</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">startMonth</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
  <span class="n">month</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">month</span>
<span class="n">day</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">startDay</span><span class="p">)</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
  <span class="n">day</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">day</span>
<span class="n">sliceNumber</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">cellNumber</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">sessionID</span> <span class="o">=</span> <span class="n">year</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> <span class="s1">&#39;__s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="c1"># mouse-id_time_slice-id_cell-id</span>
<span class="n">sessionDescription</span> <span class="o">=</span> <span class="s1">&#39;Current and voltage clamp recordings using electric/optogenetic stimulation plasticity-inducing protocol.&#39;</span>
<span class="n">expDescription</span> <span class="o">=</span> <span class="s1">&#39;Optogenetic and current stim pathways were stimulated in an interleaved fashion with a 5 second interval.&#39;</span> <span class="o">+</span>\
                 <span class="s1">&#39;Each stimulation pathway consisted of 2 stimulations at 50ms interval: 2 action potentials or 2 light pulses.&#39;</span> <span class="o">+</span>\
                 <span class="s1">&#39;After stable baselines in both pathways, plasticity protocol was induced.&#39;</span> <span class="o">+</span>\
                 <span class="s1">&#39;After plasticty protocol induced, optogenetic and current stimulation resumed as before.&#39;</span>
<span class="n">sessionNotes</span> <span class="o">=</span> <span class="s1">&#39;180126 PV mouse&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;Gender: female&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;DOB: 23/12/17 – 4/5wo&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;genotype: ??&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;ID: 065321 l0 r1&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;in NBQX and AP5&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;NEW  protocol using soph&#39;&#39;s&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;0ms gap single pre 4 post spikes with 0ms interval between the pre and 1st post&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;Slice 1&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;Cell1&#39;</span> <span class="o">+</span>\
               <span class="s1">&#39;Ok cell died within around 20 mins&#39;</span>
</pre></div>
</div>
<p>Again, these variables are mostly self-explanatory or commented in the code. The <code class="docutils literal notranslate"><span class="pre">sessionNotes</span></code> variable is coming from the <code class="docutils literal notranslate"><span class="pre">180126/180126</span> <span class="pre">lab</span> <span class="pre">book.docx.docx</span></code> file.</p>
<p>The way you define your metadata may be different. For example, you may have your own custom scripts that contain the metadata or you may store your metadata in files organised according to one of standard neuroscientific metadata formats like <a class="reference external" href="http://g-node.github.io/python-odml/">odML</a>. Whichever your preference is, this part of the NWB conversion procedure will vary depending on the individual researcher.</p>
<p>We start the conversion process by creating an <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.file.html#pynwb.file.NWBFile"><code class="docutils literal notranslate"><span class="pre">NWBFile</span></code></a> object and defining session metadata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assign NWB file fields</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">NWBFile</span><span class="p">(</span>
  <span class="n">session_description</span> <span class="o">=</span> <span class="n">sessionDescription</span><span class="p">,</span>
  <span class="n">identifier</span> <span class="o">=</span> <span class="n">sessionID</span><span class="p">,</span> 
  <span class="n">session_start_time</span> <span class="o">=</span> <span class="n">startTime</span><span class="p">,</span> 
  <span class="n">experimenter</span> <span class="o">=</span> <span class="n">experimenter</span><span class="p">,</span>  <span class="c1"># optional</span>
  <span class="n">session_id</span> <span class="o">=</span> <span class="n">sessionID</span><span class="p">,</span>  <span class="c1"># optional</span>
  <span class="n">institution</span> <span class="o">=</span> <span class="n">institution</span><span class="p">,</span>  <span class="c1"># optional</span>
  <span class="n">related_publications</span> <span class="o">=</span> <span class="n">publications</span><span class="p">,</span>  <span class="c1"># optional</span>
  <span class="n">notes</span> <span class="o">=</span> <span class="n">sessionNotes</span><span class="p">,</span>  <span class="c1"># optional</span>
  <span class="n">lab</span> <span class="o">=</span> <span class="n">lab</span><span class="p">,</span>  <span class="c1"># optional</span>
  <span class="n">experiment_description</span> <span class="o">=</span> <span class="n">expDescription</span><span class="p">)</span> <span class="c1"># optional</span>
</pre></div>
</div>
<p>Each file must have a <code class="docutils literal notranslate"><span class="pre">session_description</span></code> identifier and a <code class="docutils literal notranslate"><span class="pre">session_start_time</span></code> parameter. We then initialise the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.file.html#pynwb.file.Subject"><code class="docutils literal notranslate"><span class="pre">Subject</span></code></a> object and the metadata it contains:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create subject object</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="n">Subject</span><span class="p">(</span>
  <span class="n">subject_id</span> <span class="o">=</span> <span class="n">animalID</span><span class="p">,</span>
  <span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">,</span>
  <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">,</span>
  <span class="n">species</span> <span class="o">=</span> <span class="n">species</span><span class="p">,</span>
  <span class="n">sex</span> <span class="o">=</span> <span class="n">sex</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tutorials-pclamp-convert2nwb-py-load-data">
<span id="id2"></span><h4>Load Patch Clamp Recording Data<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-load-data" title="Permalink to this headline">#</a></h4>
<p>The next part of the conversion script loads aggregated and preprocessed data stored inside the <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126__s1c1_001_ED.mat</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;../&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> <span class="s1">&#39;__s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span> <span class="o">+</span> \
  <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_001_ED.mat&#39;</span><span class="p">,</span> <span class="n">squeeze_me</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;V&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> \
  <span class="s1">&#39;__s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_001_wave_data&#39;</span><span class="p">]</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">vcScaleFactor</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">10E12</span>
<span class="n">ccScaleFactor</span> <span class="o">=</span> <span class="mf">2.5</span><span class="o">/</span><span class="mf">10E5</span>
</pre></div>
</div>
<p>The data contains both voltage and current clamp recordings obtained in a pyramidal cell located in the hippocampal CA1 region while inhibitory cells in the vicinity are being stimulated by direct current, or optogenitically, or both. The variables that the file contains were earlier described in <a class="reference internal" href="#tutorials-pclamp-convert2nwb-matlab-variable-table"><span class="std std-ref">Table 1</span></a>.</p>
<p>The critical variables are <code class="docutils literal notranslate"><span class="pre">frameinfo</span></code> and <code class="docutils literal notranslate"><span class="pre">values</span></code>. The latter is a data matrix with one dimension corresponding to time and the other to the sweep number. <code class="docutils literal notranslate"><span class="pre">frameinfo</span></code> is further organised on the sweep basis and labels of data columns were described in <a class="reference internal" href="#tutorials-pclamp-convert2nwb-matlab-sweep-table"><span class="std std-ref">Table 2</span></a>.</p>
<p>We are interested in columns <code class="docutils literal notranslate"><span class="pre">number</span></code>, <code class="docutils literal notranslate"><span class="pre">points</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, and <code class="docutils literal notranslate"><span class="pre">label</span></code> and are going to work with these variables during the tutorial.</p>
<p>We also initialise <code class="docutils literal notranslate"><span class="pre">vcScaleFactor</span></code> and <code class="docutils literal notranslate"><span class="pre">ccScaleFactor</span></code> variables used to convert data into SI units for membrane potential and current: volts and amperes, respectively.</p>
<p>After loading the data, we extract relevant info:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract sweep and run data</span>
<span class="n">sweepIDs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;frameinfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="s1">&#39;number&#39;</span><span class="p">])</span>
<span class="n">sweepDataPoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;frameinfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="s1">&#39;points&#39;</span><span class="p">])</span>
<span class="n">sweepStartTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;frameinfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
<span class="n">sweepStates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;frameinfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
<span class="n">sweepLabels</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;frameinfo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>
<span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">runInds</span><span class="p">,</span> <span class="n">runStartTimes</span><span class="p">,</span> <span class="n">runDataPoints</span><span class="p">,</span> <span class="n">runUnits</span><span class="p">)</span> <span class="o">=</span> <span class="n">getRuns</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">,</span> <span class="n">sweepDataPoints</span><span class="p">,</span> <span class="n">sweepStartTimes</span><span class="p">)</span>
<span class="n">nSweeps</span> <span class="o">=</span> <span class="n">sweepIDs</span><span class="o">.</span><span class="n">size</span>
<span class="n">nRuns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">runs</span><span class="p">)</span>
<span class="n">endRunInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">runInds</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">nSweeps</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">runInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">runInds</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">endRunInds</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>All recording sweeps comprise five runs based on stimulus repetitions. Sweep IDs 139-198 are the first baseline condition with alternating light and current stimulation, followed by the 3-sweep long break period with no stimulation (IDs 199-201), and then followed by the inhibitory plasticity induction run of 10 longer sweeps with simultaneous light and current stimulation (IDs 202-211). The plasticity run is then followed by the second break period (IDs 212 and 213) and by the sebsequent second baseline stimulation run (IDs 214-435). 5 corresponding run labels, start sweep indices, run start times, data points per sweep, and run units are extracted by calling the local <code class="docutils literal notranslate"><span class="pre">getRuns</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">runs</span><span class="p">,</span> <span class="n">runInds</span><span class="p">,</span> <span class="n">runStartTimes</span><span class="p">,</span> <span class="n">runDataPoints</span><span class="p">,</span> <span class="n">runUnits</span><span class="p">)</span> <span class="o">=</span> <span class="n">getRuns</span><span class="p">(</span><span class="n">sweepLabels</span><span class="p">,</span> <span class="n">sweepDataPoints</span><span class="p">,</span> <span class="n">sweepStartTimes</span><span class="p">)</span>
</pre></div>
</div>
<p>The function code is given below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">runs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="s1">&#39;baseline&#39;</span><span class="p">])</span>
<span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
<span class="n">dataPoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sweepDataPoints</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">startTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sweepStartTimes</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">sweepUnits</span> <span class="o">=</span> <span class="s1">&#39;amperes&#39;</span>
<span class="n">units</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="n">sweepUnits</span><span class="p">])</span>
<span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">sweepLabels</span><span class="o">.</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">sweepLabels</span><span class="p">[</span><span class="n">sweep</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">sweepLabels</span><span class="p">[</span><span class="n">sweep</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">sweepLabels</span><span class="p">[</span><span class="n">sweep</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>
      <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;break&#39;</span><span class="p">)</span>
      <span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;amperes&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sweepLabels</span><span class="p">[</span><span class="n">sweep</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
      <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;plasticity&#39;</span><span class="p">)</span>
      <span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;volts&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">sweepLabels</span><span class="p">[</span><span class="n">sweep</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
      <span class="n">runs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;baseline&#39;</span><span class="p">)</span>
      <span class="n">units</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;amperes&#39;</span><span class="p">)</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inds</span><span class="p">,</span> <span class="n">sweep</span><span class="p">)</span>
    <span class="n">dataPoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dataPoints</span><span class="p">,</span> <span class="n">sweepDataPoints</span><span class="p">[</span><span class="n">sweep</span><span class="p">])</span>
    <span class="n">startTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">startTimes</span><span class="p">,</span> <span class="n">sweepStartTimes</span><span class="p">[</span><span class="n">sweep</span><span class="p">])</span>

<span class="k">return</span> <span class="n">runs</span><span class="p">,</span> <span class="n">inds</span><span class="p">,</span> <span class="n">startTimes</span><span class="p">,</span> <span class="n">dataPoints</span><span class="p">,</span> <span class="n">units</span>
</pre></div>
</div>
<p>We need information about runs because we are going to organise data hierarchically based on the stimulation protocol, runs of repeated stimulation protocols (repetitions), and groups of runs (or experimental conditions, in other words).</p>
</section>
<section id="tutorials-pclamp-convert2nwb-py-convert-icephys">
<span id="id3"></span><h4>Convert Intracellular Electrophysiology Recording Data<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-convert-icephys" title="Permalink to this headline">#</a></h4>
<p>We start data conversion by creating the electrode object and providing a few metadata entries about the recording setup. First, we create the recording device Amplifier_Multiclamp_700A of the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.device.html#pynwb.device.Device"><code class="docutils literal notranslate"><span class="pre">Device</span></code></a> class type:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">create_device</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Amplifier_Multiclamp_700A&#39;</span><span class="p">,</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Amplifier for recording intracellular data.&#39;</span><span class="p">,</span>
  <span class="n">manufacturer</span> <span class="o">=</span> <span class="s1">&#39;Molecular Devices&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Second, we connect the amplifier to the recording electrode when we create the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.IntracellularElectrode"><code class="docutils literal notranslate"><span class="pre">IntracellularElectrode</span></code></a> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">electrode</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">create_icephys_electrode</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;icephys_electrode&#39;</span><span class="p">,</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;A patch clamp electrode&#39;</span><span class="p">,</span>
  <span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;Cell soma in CA1 of hippocampus&#39;</span><span class="p">,</span>
  <span class="nb">slice</span> <span class="o">=</span> <span class="s1">&#39;slice #&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">),</span>
  <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</pre></div>
</div>
<p>The actual data conversion occurs when we specify and store <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.CurrentClampStimulusSeries"><code class="docutils literal notranslate"><span class="pre">CurrentClampStimulusSeries</span></code></a>, <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.CurrentClampSeries"><code class="docutils literal notranslate"><span class="pre">CurrentClampSeries</span></code></a>, <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.VoltageClampStimulusSeries"><code class="docutils literal notranslate"><span class="pre">VoltageClampStimulusSeries</span></code></a>, and <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.VoltageClampSeries"><code class="docutils literal notranslate"><span class="pre">VoltageClampSeries</span></code></a> objects. These are subclasses of the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.PatchClampSeries"><code class="docutils literal notranslate"><span class="pre">PatchClampSeries</span></code></a> class that are specifically adapted to store current clamp and voltage clamp (responses) data and associated stimulation time series data (stimuli). When creating these objects you are required to specify the <code class="docutils literal notranslate"><span class="pre">data</span></code> property which typically would be a single recording sweep with the first dimension corresponding to time. It is also useful to provide the <code class="docutils literal notranslate"><span class="pre">description</span></code> of the data, describe the stimulus using <code class="docutils literal notranslate"><span class="pre">stimulus_description</span></code> property, specify <code class="docutils literal notranslate"><span class="pre">data_unit</span></code>, provide time info by speficying <code class="docutils literal notranslate"><span class="pre">starting_time</span></code> and <code class="docutils literal notranslate"><span class="pre">starting_time_rate</span></code> properties, and link the data to the <code class="docutils literal notranslate"><span class="pre">electrode</span></code>. The code that creates stimulus and data series objects is given below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add current and voltage clamp data</span>
<span class="n">stimulusObjects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">responseObjects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSweeps</span><span class="p">):</span>
  <span class="n">run</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">runInds</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">sweep</span><span class="p">,</span> <span class="n">sweep</span> <span class="o">&lt;=</span> <span class="n">runInds</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  <span class="nb">input</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;samplingRate&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;interval&#39;</span><span class="p">],</span>
    <span class="s1">&#39;startTime&#39;</span><span class="p">:</span> <span class="n">sweepStartTimes</span><span class="p">[</span><span class="n">sweep</span><span class="p">],</span>
    <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">values</span><span class="p">[:,</span><span class="n">sweep</span><span class="p">],</span>
    <span class="s1">&#39;electrode&#39;</span><span class="p">:</span> <span class="n">electrode</span><span class="p">,</span>
    <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="n">runs</span><span class="p">[</span><span class="n">run</span><span class="p">],</span>
    <span class="s1">&#39;stimState&#39;</span><span class="p">:</span> <span class="n">sweepStates</span><span class="p">[</span><span class="n">sweep</span><span class="p">],</span>
    <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="n">runUnits</span><span class="p">[</span><span class="n">run</span><span class="p">],</span>
    <span class="s1">&#39;conditionOrder&#39;</span><span class="p">:</span> <span class="n">run</span><span class="p">,</span>
    <span class="s1">&#39;sweepOrder&#39;</span><span class="p">:</span><span class="n">sweepIDs</span><span class="p">[</span><span class="n">sweep</span><span class="p">]}</span>
  <span class="k">if</span> <span class="n">runs</span><span class="p">[</span><span class="n">run</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;plasticity&#39;</span><span class="p">:</span>
    <span class="nb">input</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;stimState&#39;</span><span class="p">)</span>
    <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">ccScaleFactor</span>
    <span class="p">(</span><span class="n">stimulusObj</span><span class="p">,</span> <span class="n">responseObj</span><span class="p">)</span> <span class="o">=</span> <span class="n">setCClampSeries</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">vcScaleFactor</span>
    <span class="p">(</span><span class="n">stimulusObj</span><span class="p">,</span> <span class="n">responseObj</span><span class="p">)</span> <span class="o">=</span> <span class="n">setVClampSeries</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
  <span class="n">stimulusObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stimulusObj</span><span class="p">)</span>
  <span class="n">responseObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">responseObj</span><span class="p">)</span>
</pre></div>
</div>
<p>It packages the needed parameters for setting up these time series objects inside the <code class="docutils literal notranslate"><span class="pre">input</span></code> dictionary and passes them into local <code class="docutils literal notranslate"><span class="pre">setCClampSeries</span></code> and <code class="docutils literal notranslate"><span class="pre">setVClampSeries</span></code> functions which output stimulus and response objects. These objects are appended to their corresponding lists, so that we can annotate these time series objects and organise them hierarchically. The code for <code class="docutils literal notranslate"><span class="pre">setCClampSeries</span></code> function is given below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">currentClampStimulusSeries</span> <span class="o">=</span> <span class="n">CurrentClampStimulusSeries</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CurrentClampStimulusSeries&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;conditionOrder&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_sweep&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;sweepOrder&#39;</span><span class="p">]),</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Plasticity condition&#39;</span><span class="p">,</span>
  <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;amperes&#39;</span><span class="p">,</span>
  <span class="n">electrode</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;electrode&#39;</span><span class="p">],</span>
  <span class="n">stimulus_description</span> <span class="o">=</span> <span class="s1">&#39;Plasticity protocol: Simultaneous current and light stimulation&#39;</span><span class="p">,</span>
  <span class="n">starting_time</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">],</span>
  <span class="n">rate</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;samplingRate&#39;</span><span class="p">])</span>

<span class="n">currentClampSeries</span> <span class="o">=</span> <span class="n">CurrentClampSeries</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;CurrentClampSeries&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;conditionOrder&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_sweep&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;sweepOrder&#39;</span><span class="p">]),</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Plasticity condition&#39;</span><span class="p">,</span>
  <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
  <span class="n">electrode</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;electrode&#39;</span><span class="p">],</span>
  <span class="n">stimulus_description</span> <span class="o">=</span> <span class="s1">&#39;Plasticity protocol: Simultaneous current and light stimulation&#39;</span><span class="p">,</span>
  <span class="n">starting_time</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">],</span>
  <span class="n">rate</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;samplingRate&#39;</span><span class="p">])</span>

<span class="k">return</span> <span class="n">currentClampStimulusSeries</span><span class="p">,</span> <span class="n">currentClampSeries</span>
</pre></div>
</div>
<p>and the code for <code class="docutils literal notranslate"><span class="pre">setVClampSeries</span></code> function is given here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;baseline&#39;</span><span class="p">:</span>
  <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;stimState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Baseline condition: Light stimulation&#39;</span>
    <span class="n">stimDescription</span> <span class="o">=</span> <span class="s1">&#39;Baseline stimulation: Double light pulses.&#39;</span>
  <span class="k">elif</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;stimState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Baseline condition: Current stimulation&#39;</span>
    <span class="n">stimDescription</span> <span class="o">=</span> <span class="s1">&#39;Baseline stimulation: Double current pulses.&#39;</span>
<span class="k">elif</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;break&#39;</span><span class="p">:</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Break sweeps are used while switching between two conditions: Nothing happens.&#39;</span>
  <span class="n">stimDescription</span> <span class="o">=</span> <span class="s1">&#39;No stimulation.&#39;</span>

<span class="n">voltageClampStimulusSeries</span> <span class="o">=</span> <span class="n">VoltageClampStimulusSeries</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;VoltageClampStimulusSeries&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;conditionOrder&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_sweep&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;sweepOrder&#39;</span><span class="p">]),</span>
  <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">,</span>
  <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;volts&#39;</span><span class="p">,</span>
  <span class="n">electrode</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;electrode&#39;</span><span class="p">],</span>
  <span class="n">stimulus_description</span> <span class="o">=</span> <span class="n">stimDescription</span><span class="p">,</span>
  <span class="n">starting_time</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">],</span>
  <span class="n">rate</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;samplingRate&#39;</span><span class="p">])</span>

<span class="n">voltageClampSeries</span> <span class="o">=</span> <span class="n">VoltageClampSeries</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;VoltageClampSeries&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;conditionOrder&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_sweep&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="s1">&#39;sweepOrder&#39;</span><span class="p">]),</span>
  <span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">,</span>
  <span class="n">data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span>
  <span class="n">unit</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span>
  <span class="n">electrode</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;electrode&#39;</span><span class="p">],</span>
  <span class="n">stimulus_description</span> <span class="o">=</span> <span class="n">stimDescription</span><span class="p">,</span>
  <span class="n">starting_time</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;startTime&#39;</span><span class="p">],</span>
  <span class="n">rate</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="s1">&#39;samplingRate&#39;</span><span class="p">])</span>

<span class="k">return</span> <span class="n">voltageClampStimulusSeries</span><span class="p">,</span> <span class="n">voltageClampSeries</span>
</pre></div>
</div>
<p>We use the same data for stimuli and responses as stimuli data has not been recorded. Later when creating recordings table we are going to indicate that stimulation data does not really exist.</p>
</section>
<section id="tutorials-pclamp-convert2nwb-py-recordings-table">
<span id="id4"></span><h4>Create Intracellular Recordings Table<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-recordings-table" title="Permalink to this headline">#</a></h4>
<p>It is useful to group stimuli and responses together, as well as associate them with important metadata. By doing so we make it easier to access these time series objects based on their metadata properties and appropriately process and analyse them collectively as required. The <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.IntracellularRecordingsTable"><code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code></a> class allows to do just that. It is a subclass of <a class="reference external" href="https://hdmf.readthedocs.io/en/stable/hdmf.common.alignedtable.html#hdmf.common.alignedtable.AlignedDynamicTable"><code class="docutils literal notranslate"><span class="pre">AlignedDynamicTable</span></code></a> class that can group multiple objects of <a class="reference external" href="https://hdmf.readthedocs.io/en/stable/hdmf.common.table.html#hdmf.common.table.DynamicTable"><code class="docutils literal notranslate"><span class="pre">DynamicTable</span></code></a> type. In the case of intracellular recordings, it groups together electrode metadata (<a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.IntracellularElectrodesTable"><code class="docutils literal notranslate"><span class="pre">IntracellularElectrodesTable</span></code></a>), with stimuli (<a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.IntracellularStimuliTable"><code class="docutils literal notranslate"><span class="pre">IntracellularStimuliTable</span></code></a>), responses (<a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.IntracellularResponsesTable"><code class="docutils literal notranslate"><span class="pre">IntracellularResponsesTable</span></code></a>), and any other custom metadata. We start by creating <code class="docutils literal notranslate"><span class="pre">IntracellularElectrodesTable</span></code> and adding recordings one by one using <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.file.html#pynwb.file.NWBFile.add_intracellular_recording"><code class="docutils literal notranslate"><span class="pre">add_intracellular_recording</span></code></a> function of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create intracellular recordings table</span>
<span class="n">rowIndices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sweep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSweeps</span><span class="p">):</span>
  <span class="n">rowIndices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nwb</span><span class="o">.</span><span class="n">add_intracellular_recording</span><span class="p">(</span>
    <span class="n">electrode</span><span class="o">=</span><span class="n">electrode</span><span class="p">,</span>
    <span class="n">stimulus</span><span class="o">=</span><span class="n">stimulusObjects</span><span class="p">[</span><span class="n">sweep</span><span class="p">],</span>
    <span class="n">stimulus_start_index</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">stimulus_index_count</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="n">responseObjects</span><span class="p">[</span><span class="n">sweep</span><span class="p">],</span>
    <span class="n">response_start_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">response_index_count</span><span class="o">=</span><span class="n">sweepDataPoints</span><span class="p">[</span><span class="n">sweep</span><span class="p">],</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">sweepIDs</span><span class="p">[</span><span class="n">sweep</span><span class="p">]))</span>
</pre></div>
</div>
<p>By passing in -1 as <code class="docutils literal notranslate"><span class="pre">stimulus_start_index</span></code> and <code class="docutils literal notranslate"><span class="pre">stimulus_index_count</span></code> properties, we indicate that stimulation data does not exist and only the response data should be stored. The creation of <code class="docutils literal notranslate"><span class="pre">stimulusObjects</span></code> and <code class="docutils literal notranslate"><span class="pre">responseObjects</span></code> lists was described in the previous subsection. <code class="docutils literal notranslate"><span class="pre">rowIndices</span></code> list is used subsequently when grouping sweeps.</p>
<p>As mentioned earlier, <code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code> can contain additional custom fields or categories. This allows us to group sweep metadata info into a single <code class="docutils literal notranslate"><span class="pre">DynamicTable</span></code> class object and associate this metadata to corresponding recording sweep data. Additional metadata columns that we add to the recordings table include <code class="docutils literal notranslate"><span class="pre">order</span></code>, <code class="docutils literal notranslate"><span class="pre">points</span></code>, <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">state</span></code>, and <code class="docutils literal notranslate"><span class="pre">label</span></code>. They all are converted to <a class="reference external" href="https://hdmf.readthedocs.io/en/stable/hdmf.common.table.html#hdmf.common.table.VectorData"><code class="docutils literal notranslate"><span class="pre">VectorData</span></code></a> objects prior to being grouped into a single object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the sweep metadata category to the intracellular recording table</span>
<span class="n">orderCol</span> <span class="o">=</span> <span class="n">VectorData</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;order&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">sweepIDs</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Recorded sweep order.&#39;</span><span class="p">)</span>

<span class="n">pointsCol</span> <span class="o">=</span> <span class="n">VectorData</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;points&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">sweepDataPoints</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The number of data points within the sweep.&#39;</span><span class="p">)</span>

<span class="n">startCol</span> <span class="o">=</span> <span class="n">VectorData</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;start&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">sweepStartTimes</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The sweep recording start time in seconds.&#39;</span><span class="p">)</span>

<span class="n">stateCol</span> <span class="o">=</span> <span class="n">VectorData</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">sweepStates</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The experimental state ID: &#39;</span> <span class="o">+</span> \
              <span class="s1">&#39;0 - light stimulation during the baseline condition.&#39;</span> <span class="o">+</span> \
              <span class="s1">&#39;1 - current stimulation during the baseline condition.&#39;</span> <span class="o">+</span> \
              <span class="s1">&#39;2 - inhibitory synaptic plasticity induction condition.&#39;</span> <span class="o">+</span> \
              <span class="s1">&#39;9 - break between baseline and plasticity induction conditions.&#39;</span><span class="p">)</span>

<span class="n">labelCol</span> <span class="o">=</span> <span class="n">VectorData</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">sweepLabels</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The experimental state label.&#39;</span><span class="p">)</span>

<span class="n">conditions</span> <span class="o">=</span> <span class="n">VectorData</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">sweepLabels</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;The experimental condition.&#39;</span><span class="p">)</span>

<span class="n">sweepMetadata</span> <span class="o">=</span> <span class="n">DynamicTable</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sweeps&#39;</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Sweep metadata.&#39;</span><span class="p">,</span>
  <span class="n">colnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">,</span><span class="s1">&#39;points&#39;</span><span class="p">,</span><span class="s1">&#39;start&#39;</span><span class="p">,</span><span class="s1">&#39;state&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">,</span><span class="s1">&#39;condition&#39;</span><span class="p">],</span>
  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">orderCol</span><span class="p">,</span><span class="n">pointsCol</span><span class="p">,</span><span class="n">startCol</span><span class="p">,</span><span class="n">stateCol</span><span class="p">,</span><span class="n">labelCol</span><span class="p">,</span><span class="n">conditions</span><span class="p">])</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">intracellular_recordings</span><span class="o">.</span><span class="n">add_category</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">sweepMetadata</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tutorials-pclamp-convert2nwb-py-group-sweeps">
<span id="id5"></span><h4>Group Intracellular Recording Sweeps<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-group-sweeps" title="Permalink to this headline">#</a></h4>
<p>NWB files provide a way to group intracellular recordings in a hierarchical manner. You can indicate which recordings were obtained simultaneously, if any. You can further group the simultaneous recordings into sequential recordings and runs (or repetitions). Finally you can group runs into experimental conditions. All these groupings are <code class="docutils literal notranslate"><span class="pre">DynamicTable</span></code> classes that allow adding custom metadata entries. Specifying metadata at different hierarchy levels avoids specifying this information for every recording sweep. If you decide to use these optional groupings, using a particular grouping type implies that you also use groupings of lower hierarchy.</p>
<section id="tutorials-pclamp-convert2nwb-py-group-sweeps-simultaneous">
<span id="id6"></span><h5>Group Simultaneously Recorded Sweeps<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-simultaneous" title="Permalink to this headline">#</a></h5>
<p>The data used in this tutorial have no recordings that were obtained simultaneously. Therefore, each sweep serves as the only member of individual instances of simultaneous recordings. The reason why we still have to create simultaneous recordings group to organise the sweeps is that we intend to use groupings of higher order. We use the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.SimultaneousRecordingsTable"><code class="docutils literal notranslate"><span class="pre">SimultaneousRecordingsTable</span></code></a> to group simultaneously acquired sweeps and the code demonstrating how to do it is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group simultaneous recordings</span>
<span class="c1"># Create a simultaneous recordings table with a custom column</span>
<span class="c1"># &#39;simultaneous_recording_tag&#39;</span>
<span class="n">icephys_simultaneous_recordings</span> <span class="o">=</span> <span class="n">nwb</span><span class="o">.</span><span class="n">get_icephys_simultaneous_recordings</span><span class="p">()</span>
<span class="n">icephys_simultaneous_recordings</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;simultaneous_recording_tag&#39;</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A custom tag for simultaneous_recordings&#39;</span><span class="p">)</span>

<span class="n">rowIndicesSimRec</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">iSweep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSweeps</span><span class="p">):</span>
  <span class="n">rowIndicesSimRec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nwb</span><span class="o">.</span><span class="n">add_icephys_simultaneous_recording</span><span class="p">(</span>
    <span class="n">recordings</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rowIndices</span><span class="p">[</span><span class="n">iSweep</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">sweepIDs</span><span class="p">[</span><span class="n">iSweep</span><span class="p">],</span>
    <span class="n">simultaneous_recording_tag</span><span class="o">=</span><span class="s1">&#39;noSimultaneousRecs&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>As you noticed, we added a custom <code class="docutils literal notranslate"><span class="pre">simultaneous_recording_tag</span></code> column to the table and we added in <code class="docutils literal notranslate"><span class="pre">rowIndices</span></code> of the <code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code> sweep by sweep. <code class="docutils literal notranslate"><span class="pre">SimultaneousRecordingsTable</span></code> and other groupings of increasing hierarchical order use indices of the previous groupings as references that ultimately have row indices of <code class="docutils literal notranslate"><span class="pre">IntracellularRecordingsTable</span></code> at their basis.</p>
</section>
<section id="tutorials-pclamp-convert2nwb-py-group-sweeps-sequential">
<span id="id7"></span><h5>Group Sequentially Recorded Sweeps<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-sequential" title="Permalink to this headline">#</a></h5>
<p><a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.SequentialRecordingsTable"><code class="docutils literal notranslate"><span class="pre">SequentialRecordingsTable</span></code></a> is the next level in the groupings hierarchy. We use it to group sweeps that have the same stimulation protocol within individual runs. We add sequential recordings consisting of lists of row indices of simultaneous recordings one by one by invoking <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.file.html#pynwb.file.NWBFile.add_icephys_sequential_recording"><code class="docutils literal notranslate"><span class="pre">add_icephys_sequential_recording</span></code></a> function of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object. We also specify the stimulus type associated with each sequential recordings group:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group sequential recordings using the same type of stimulus</span>
<span class="c1"># Group indices of sequential recordings in a sequential recordings table</span>
<span class="n">seqGroupCount</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">iRun</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRuns</span><span class="p">):</span>
  <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">runInds</span><span class="p">[</span><span class="n">iRun</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">runInds</span><span class="p">[</span><span class="n">iRun</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">condStates</span> <span class="o">=</span> <span class="n">sweepStates</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
  <span class="n">uniqueSweepStates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">condStates</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">iState</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">uniqueSweepStates</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">uniqueSweepStates</span><span class="p">[</span><span class="n">iState</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">stimulusType</span> <span class="o">=</span> <span class="s1">&#39;light&#39;</span>
    <span class="k">elif</span> <span class="n">uniqueSweepStates</span><span class="p">[</span><span class="n">iState</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">stimulusType</span> <span class="o">=</span> <span class="s1">&#39;current&#39;</span>
    <span class="k">elif</span> <span class="n">uniqueSweepStates</span><span class="p">[</span><span class="n">iState</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">stimulusType</span> <span class="o">=</span> <span class="s1">&#39;combined&#39;</span>
    <span class="k">elif</span> <span class="n">uniqueSweepStates</span><span class="p">[</span><span class="n">iState</span><span class="p">]</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
      <span class="n">stimulusType</span> <span class="o">=</span> <span class="s1">&#39;noStim&#39;</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">condStates</span> <span class="o">==</span> <span class="n">uniqueSweepStates</span><span class="p">[</span><span class="n">iState</span><span class="p">])</span>
    <span class="n">nwb</span><span class="o">.</span><span class="n">add_icephys_sequential_recording</span><span class="p">(</span>
      <span class="n">simultaneous_recordings</span><span class="o">=</span><span class="p">[</span><span class="n">rowIndicesSimRec</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">inds</span><span class="p">],</span>
      <span class="n">stimulus_type</span><span class="o">=</span><span class="n">stimulusType</span><span class="p">,</span>
      <span class="nb">id</span><span class="o">=</span><span class="n">seqGroupCount</span><span class="p">)</span>
    <span class="n">seqGroupCount</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="tutorials-pclamp-convert2nwb-py-group-sweeps-repetitions">
<span id="id8"></span><h5>Group Recordings into Runs<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-repetitions" title="Permalink to this headline">#</a></h5>
<p>We used stimulation type to group sweeps into 7 sequential recordings groups. We can further group these sequential recordings into runs using <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/RepetitionsTable.html"><code class="docutils literal notranslate"><span class="pre">RepetitionsTable</span></code></a> class. Typically, this class is used to group recordings with different stimuli into sequences that can be repeated. The code showing how we group 7 sequential recordings into runs is below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group recordings into runs</span>
<span class="c1"># Group indices of individual runs</span>
<span class="n">runInds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]])</span>

<span class="c1"># Create a repetitions table</span>
<span class="k">for</span> <span class="n">iRun</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRuns</span><span class="p">):</span>
  <span class="n">nwb</span><span class="o">.</span><span class="n">add_icephys_repetition</span><span class="p">(</span>
    <span class="n">sequential_recordings</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">runInds</span><span class="p">[</span><span class="n">iRun</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">iRun</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tutorials-pclamp-convert2nwb-py-group-sweeps-conditions">
<span id="id9"></span><h5>Group Runs into Experimental Conditions<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-group-sweeps-conditions" title="Permalink to this headline">#</a></h5>
<p>Runs form the basis for the highest order grouping implemented by the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.icephys.html#pynwb.icephys.ExperimentalConditionsTable"><code class="docutils literal notranslate"><span class="pre">ExperimentalConditionsTable</span></code></a> class. We use this class to group our runs, as well as to add the experimental conditions <code class="docutils literal notranslate"><span class="pre">tag</span></code> to the <code class="docutils literal notranslate"><span class="pre">ExperimentalConditionsTable</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Group runs into experimental conditions</span>
<span class="c1"># Group indices, tags, and descriptions for different conditions</span>
<span class="n">condInds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">condTags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">([</span><span class="s1">&#39;baselineStim&#39;</span><span class="p">,</span><span class="s1">&#39;noStim&#39;</span><span class="p">,</span><span class="s1">&#39;plasticityInduction&#39;</span><span class="p">])</span>

<span class="c1"># Create experimental conditions table</span>
<span class="k">for</span> <span class="n">iCond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">condInds</span><span class="p">)):</span>
  <span class="n">nwb</span><span class="o">.</span><span class="n">add_icephys_experimental_condition</span><span class="p">(</span>
    <span class="n">repetitions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">condInds</span><span class="p">[</span><span class="n">iCond</span><span class="p">],</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">iCond</span><span class="p">)</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">icephys_experimental_conditions</span><span class="o">.</span><span class="n">add_column</span><span class="p">(</span>
  <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tag&#39;</span><span class="p">,</span>
  <span class="n">data</span><span class="o">=</span><span class="n">condTags</span><span class="p">,</span>
  <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Experimental condition label&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="tutorials-pclamp-convert2nwb-py-add-image">
<span id="id10"></span><h4>Add Recording Slice Image<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-add-image" title="Permalink to this headline">#</a></h4>
<p>During the recording the brain slice was photographed and saved as a grayscale image inside <code class="docutils literal notranslate"><span class="pre">180126/Slice1/Cell1/180126</span> <span class="pre">s1c1.jpg</span></code> file. We can read this image using <code class="docutils literal notranslate"><span class="pre">cv2.imread</span></code> function and store it inside the <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.image.html#pynwb.image.GrayscaleImage"><code class="docutils literal notranslate"><span class="pre">GrayscaleImage</span></code></a> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">imageFilename</span> <span class="o">=</span> <span class="s1">&#39;../&#39;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="n">month</span> <span class="o">+</span> <span class="n">day</span> <span class="o">+</span> <span class="s1">&#39; s&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;c&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.jpg&#39;</span>
<span class="n">sliceImage</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">imageFilename</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">)</span>

<span class="n">sliceImage</span> <span class="o">=</span> <span class="n">GrayscaleImage</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;slice_image&#39;</span><span class="p">,</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">sliceImage</span><span class="p">,</span> <span class="c1"># required: [height, width]</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Grayscale image of the recording slice.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We then add the image object to the image container object <code class="docutils literal notranslate"><span class="pre">imageCollection</span></code> using <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.base.html#pynwb.base.Images"><code class="docutils literal notranslate"><span class="pre">Images</span></code></a> class and add the image container to the <code class="docutils literal notranslate"><span class="pre">acquisition</span></code> data interface of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">imageCollection</span> <span class="o">=</span> <span class="n">Images</span><span class="p">(</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ImageCollection&#39;</span><span class="p">,</span>
  <span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">sliceImage</span><span class="p">],</span>
  <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;A container for slice images.&#39;</span><span class="p">)</span>

<span class="n">nwb</span><span class="o">.</span><span class="n">add_acquisition</span><span class="p">(</span><span class="n">imageCollection</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tutorials-pclamp-convert2nwb-py-save">
<span id="id11"></span><h4>Save NWB File<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-save" title="Permalink to this headline">#</a></h4>
<p>We use the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/pynwb.html?highlight=NWBHDF5IO#pynwb.NWBHDF5IO"><code class="docutils literal notranslate"><span class="pre">NWBHDF5IO</span></code></a> class to save our data in the NWB format:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">NWBHDF5IO</span><span class="p">(</span><span class="n">sessionID</span> <span class="o">+</span> <span class="s1">&#39;.nwb&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">io</span><span class="p">:</span>
  <span class="n">io</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">nwb</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="tutorials-pclamp-convert2nwb-py-read">
<span id="id12"></span><h4>Read NWB File<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-read" title="Permalink to this headline">#</a></h4>
</section>
<section id="tutorials-pclamp-convert2nwb-py-validate">
<span id="id13"></span><h4>Validate NWB File<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-validate" title="Permalink to this headline">#</a></h4>
<p>For validating NWB files use command line and type in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">validate</span> <span class="mi">180126</span><span class="n">__s1c1</span><span class="o">.</span><span class="n">nwb</span>
</pre></div>
</div>
<p>in order to validate the file that was recently created. The output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Validating</span> <span class="mi">180126</span><span class="n">__s1c1</span><span class="o">.</span><span class="n">nwb</span> <span class="n">against</span> <span class="n">cached</span> <span class="n">namespace</span> <span class="n">information</span> <span class="n">using</span> <span class="n">namespace</span> <span class="s1">&#39;core&#39;</span><span class="o">.</span>
 <span class="o">-</span> <span class="n">no</span> <span class="n">errors</span> <span class="n">found</span><span class="o">.</span>
</pre></div>
</div>
<p>The program exit code should be 0. On error, the program exit code is 1 and the list of errors is outputted.</p>
<p>For more details on the validation process, refer to an external <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/validation.html">resource</a>.</p>
</section>
<section id="tutorials-pclamp-convert2nwb-py-resources">
<span id="id14"></span><h4>Resources<a class="headerlink" href="#tutorials-pclamp-convert2nwb-py-resources" title="Permalink to this headline">#</a></h4>
</section>
</section>
<section id="examine-nwb-file-structure-using-hdfview">
<span id="tutorials-pclamp-convert2nwb-hdfview"></span><h3>Examine NWB File Structure Using HDFView<a class="headerlink" href="#examine-nwb-file-structure-using-hdfview" title="Permalink to this headline">#</a></h3>
<p>You can use <a class="reference external" href="https://www.hdfgroup.org/downloads/hdfview">HDF View</a> software to visualise the structure of your NWB files using a simple graphical interface.</p>
</section>
</section>
<section id="upload-your-standardised-data-to-remote-repository">
<span id="tutorials-pclamp-upload-nwb"></span><h2>Upload Your Standardised Data to Remote Repository<a class="headerlink" href="#upload-your-standardised-data-to-remote-repository" title="Permalink to this headline">#</a></h2>
</section>
<section id="roll-back-repository-to-an-earlier-version">
<span id="tutorials-pclamp-roll-back"></span><h2>Roll back Repository to an Earlier Version<a class="headerlink" href="#roll-back-repository-to-an-earlier-version" title="Permalink to this headline">#</a></h2>
</section>
<section id="acknowledgements">
<span id="tutorials-pclamp-acknowledge"></span><h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">#</a></h2>
<p>This tutorial was made possible with the kind help of <a class="reference external" href="https://www.linkedin.com/in/matt-udakis-21070485/?originalSubdomain=uk">Matt Udakis</a> who provided intracellular recording data samples.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is work in progress. Current priority!</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Bristol%20GIN%20for%20Silicon%20Probe%20Data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Bristol GIN for Silicon Probe Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Bristol%20GIN%20for%20Calcium%20Imaging%20Data.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bristol GIN for Calcium Imaging Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Martynas Dervinis<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>