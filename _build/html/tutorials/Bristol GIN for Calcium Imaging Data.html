
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Bristol GIN for Calcium Imaging Data</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css-rules.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bristol GIN for Neuroimaging Data" href="Bristol%20GIN%20for%20Neuroimaging%20Data.html" />
    <link rel="prev" title="Bristol GIN for Patch Clamp Data" href="Bristol%20GIN%20for%20Patch%20Clamp%20Data.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to Bristol Neuroscience Data Guide
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Documentation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Installation%20Instructions.html">
   Installation Instructions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN.html">
   Repository Management with GIN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN%20Web%20Interface.html">
   Repository Management with GIN Web Interface
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20WinGIN.html">
   Repository Management with WinGIN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN%20Client.html">
   Repository Management with GIN Client
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Repository%20Management%20with%20Git.html">
   Repository Management with Git
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../documentation/Recording%20Metadata.html">
   Recording Metadata
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20via%20Graphical%20Interfaces.html">
   Bristol GIN via Graphical Interfaces
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20via%20Command%20Line.html">
   Bristol GIN via Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20for%20Silicon%20Probe%20Data.html">
   Bristol GIN for Silicon Probe Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20for%20Patch%20Clamp%20Data.html">
   Bristol GIN for Patch Clamp Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Bristol GIN for Calcium Imaging Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Bristol%20GIN%20for%20Neuroimaging%20Data.html">
   Bristol GIN for Neuroimaging Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Converting%20to%20NWB.html">
   Converting to NWB
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Converting%20to%20BIDS.html">
   Converting to BIDS
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/Community.html">
   Community
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/Bristol%20GIN%20Project.html">
   Bristol GIN Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/GIN%20Project.html">
   GIN Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/GIN-Tonic%20Project.html">
   GIN-Tonic Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/NWB%20Project.html">
   NWB Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../resources/BIDS%20Project.html">
   BIDS Project
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/dervinism/bristol-neuroscience-data-guide"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/dervinism/bristol-neuroscience-data-guide/issues/new?title=Issue%20on%20page%20%2Ftutorials/Bristol GIN for Calcium Imaging Data.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/tutorials/Bristol GIN for Calcium Imaging Data.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-gin-account">
   Create GIN Account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-mock-data">
   Download Mock Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-your-research-data-repository">
   Set up Your Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-repository">
   Upload Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remove-content-of-your-local-research-data-repository">
   Remove Content of Your Local Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-your-data-to-standardised-format">
   Convert Your Data to Standardised Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-matlab">
     Convert to NWB Using Matlab
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-matnwb-toolbox">
       Install MatNWB Toolbox
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#record-metadata">
       Record Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-imaging-planes">
       Create Imaging Planes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-imaging-recording-data">
       Load Imaging/Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-fluorescence-data">
       Convert Fluorescence Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-change-in-fluorescence-intensity-data">
       Convert Change in Fluorescence Intensity Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-static-fluorescence-images">
       Convert Static Fluorescence Images
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-intracellular-electrophysiology-recording-data">
       Convert Intracellular Electrophysiology Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#save-nwb-file">
       Save NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#read-nwb-file">
       Read NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#validate-nwb-file">
       Validate NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#resources">
       Resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-python">
     Convert to NWB Using Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-pynwb">
       Install PyNWB
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-caimage-convert2nwb-py-validate">
       Validate NWB File
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Bristol GIN for Calcium Imaging Data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-gin-account">
   Create GIN Account
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-mock-data">
   Download Mock Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#set-up-your-research-data-repository">
   Set up Your Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#upload-repository">
   Upload Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#remove-content-of-your-local-research-data-repository">
   Remove Content of Your Local Research Data Repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-your-data-to-standardised-format">
   Convert Your Data to Standardised Format
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-matlab">
     Convert to NWB Using Matlab
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-matnwb-toolbox">
       Install MatNWB Toolbox
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#record-metadata">
       Record Metadata
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-imaging-planes">
       Create Imaging Planes
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#load-imaging-recording-data">
       Load Imaging/Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-fluorescence-data">
       Convert Fluorescence Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-change-in-fluorescence-intensity-data">
       Convert Change in Fluorescence Intensity Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-static-fluorescence-images">
       Convert Static Fluorescence Images
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#convert-intracellular-electrophysiology-recording-data">
       Convert Intracellular Electrophysiology Recording Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#save-nwb-file">
       Save NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#read-nwb-file">
       Read NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#validate-nwb-file">
       Validate NWB File
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#resources">
       Resources
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-to-nwb-using-python">
     Convert to NWB Using Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#install-pynwb">
       Install PyNWB
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tutorials-caimage-convert2nwb-py-validate">
       Validate NWB File
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="bristol-gin-for-calcium-imaging-data">
<span id="tutorials-caimage"></span><h1>Bristol GIN for Calcium Imaging Data<a class="headerlink" href="#bristol-gin-for-calcium-imaging-data" title="Permalink to this headline">#</a></h1>
<section id="create-gin-account">
<span id="tutorials-caimage-create-account"></span><h2>Create GIN Account<a class="headerlink" href="#create-gin-account" title="Permalink to this headline">#</a></h2>
<p>In order to be able to follow this tutorial, you need to have a GIN account either on Bristol GIN or on the public GIN service. GIN web interface documentation has it all explained <a class="reference internal" href="../documentation/Repository%20Management%20with%20GIN%20Web%20Interface.html#doc-gin-web-register"><span class="std std-ref">here</span></a>.</p>
<p>After creating the account, login to it by typing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">login</span>
</pre></div>
</div>
</section>
<section id="download-mock-data">
<span id="tutorials-caimage-download-data"></span><h2>Download Mock Data<a class="headerlink" href="#download-mock-data" title="Permalink to this headline">#</a></h2>
<p>We are going to download Ca2+ imaging data available in dervinism/calcium-imaging-mock-repo repository. To get the data, type in the lines below to your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">get</span> <span class="n">dervinism</span><span class="o">/</span><span class="n">calcium</span><span class="o">-</span><span class="n">imaging</span><span class="o">-</span><span class="n">mock</span><span class="o">-</span><span class="n">repo</span>
<span class="n">cd</span> <span class="n">calcium</span><span class="o">-</span><span class="n">imaging</span><span class="o">-</span><span class="n">mock</span><span class="o">-</span><span class="n">repo</span>
<span class="n">gin</span> <span class="n">get</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
<p>This is part of the real Ca2+ imaging data. The imaging was performed in hippocampal pyramidal cells during Schaffer collateral stimulation. Dendrites at different cell locations were two-photon linescan imaged. More about the project that this data is coming from can be read in the README file. The data is organised into individual imaging/recording sessions named using number IDs. It is further subdivided into slices and cells. Processed data is places in the Analysed folder inside the MAT file. The raw data is located in two separate folders: Ephysdata for electrophysiology data and Imgdata for imaging data. README files located in calcium-imaging-mock-repo\Exp_001_SCstim_DiffLocations\201204 session folder give more detail about what sort of data is stored, variable names and their meaning, and other relevant information.</p>
</section>
<section id="set-up-your-research-data-repository">
<span id="tutorials-caimage-setup-repo"></span><h2>Set up Your Research Data Repository<a class="headerlink" href="#set-up-your-research-data-repository" title="Permalink to this headline">#</a></h2>
<p>You should rename your repository, delete the .git folder located inside the repository root folder, and update your README file if needed. Once this is done, issue the command below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">init</span>
</pre></div>
</div>
<p>This would intialise the local repository.</p>
</section>
<section id="upload-repository">
<span id="tutorials-caimage-upload-repo"></span><h2>Upload Repository<a class="headerlink" href="#upload-repository" title="Permalink to this headline">#</a></h2>
<p>The next step is to create a remote repository with the same name and associate it with the local repository. You can simply do it by typing in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">add</span><span class="o">-</span><span class="n">remote</span> <span class="n">your</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">name</span> <span class="n">gin</span><span class="p">:</span><span class="n">your</span><span class="o">-</span><span class="n">username</span><span class="o">/</span><span class="n">your</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">name</span> <span class="o">--</span><span class="n">default</span>
</pre></div>
</div>
<p>In this case, the remote repository is going to be created since it does not exist. You can now type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">commit</span> <span class="o">.</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;Initial commit&quot;</span>
<span class="n">gin</span> <span class="n">upload</span> <span class="o">.</span>
</pre></div>
</div>
<p>The first command would record local changes with the local version control system. By doing so you create the image of your repository that can always be reverted to in the future in case the need to do so arises. When commiting local repository changes to your version control system you typically provide a concise message describing the changes. By convention, the message length should not exceed 50 characters. Dot means that the command is executed on the contents of the current working directory; therefore, make sure that you are inside the root folder of your repository when carrying out this action. The flag -m is used to pass the commit message. When you make new changes to the repository, whether editing text files or manipulating your data files, you should commit these changes periodically to your local versioning system. Finally, the <code class="docutils literal notranslate"><span class="pre">upload</span></code> command updates the remote instance of the repository with the changes that were commited locally up to this point.</p>
<p>Alternatively, you can create a repository using the GIN web interface. You do it by clicking the plus sign in the top menu and then clicking and chosing the New Repository option.</p>
<a class="reference internal image-reference" href="../_images/Fig01-create-repo1.png" id="fig-gin-caimage-create-repo1"><img alt="../_images/Fig01-create-repo1.png" class="align-center" id="fig-gin-caimage-create-repo1" src="../_images/Fig01-create-repo1.png" style="width: 690px;" /></a>
<p>       <strong>Figure 1. Create Repository Using Web Interface</strong></p>
<p>You should see the New Repository window where you enter the name of the repository and its description as shown below.</p>
<a class="reference internal image-reference" href="../_images/Fig02-create-repo2.png" id="fig-gin-caimage-create-repo2"><img alt="../_images/Fig02-create-repo2.png" class="align-center" id="fig-gin-caimage-create-repo2" src="../_images/Fig02-create-repo2.png" style="width: 690px;" /></a>
<p>       <strong>Figure 2. Enter Repository Details Using Web Interface</strong></p>
<p>Finally, you can upload files by clicking the blue Upload file button on the repository page.</p>
<a class="reference internal image-reference" href="../_images/Fig03-upload-repo.png" id="fig-gin-caimage-upload-repo"><img alt="../_images/Fig03-upload-repo.png" class="align-center" id="fig-gin-caimage-upload-repo" src="../_images/Fig03-upload-repo.png" style="width: 690px;" /></a>
<p>       <strong>Figure 3. Upload Repository Files Using Web Interface</strong></p>
<p>The limitation of using the web interface is that every time you update your remote repository (upload files), you will be limited to uploading 100 files at a time with each file being no larger than 10 gigabytes. Therefore, it is more effecient/effective to use the command line tools which have none of these limitations.</p>
<p>When you use the web interface, you can specify the commit message title (no more than 50 characters by convention) and the commit message body (no more than 72 characters by convention).</p>
</section>
<section id="remove-content-of-your-local-research-data-repository">
<span id="tutorials-caimage-remove-content"></span><h2>Remove Content of Your Local Research Data Repository<a class="headerlink" href="#remove-content-of-your-local-research-data-repository" title="Permalink to this headline">#</a></h2>
<p>One advantage of using GIN for your data repository mangement is that you do not need to keep duplicate repositories in order to prevent accidental detrimental changes to your main repository. One reason for that is having version control system. The other reason is that you can safely remove the content of your local repository and replace it with pointers to original files. As a result you can save space on your local hard-drive. To remove the local content type the following line in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
<p>Local files larger than 10 megabytes should be replaced by symbolic links. In case you want to remove the content of specific files only, you can type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span> <span class="o">&lt;</span><span class="n">absolute</span> <span class="ow">or</span> <span class="n">relative</span> <span class="n">path</span> <span class="n">to</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">folder</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>For example, to remove particular raw research data from our calcium imaging data repository, we type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span> <span class="n">Exp_001_SCstim_DiffLocations</span><span class="o">/</span><span class="mi">201204</span><span class="o">/</span><span class="n">Slice_002</span><span class="o">/</span><span class="n">Cell_001</span><span class="o">/</span><span class="n">Ephysdata</span>
<span class="n">gin</span> <span class="n">remove</span><span class="o">-</span><span class="n">content</span> <span class="n">Exp_001_SCstim_DiffLocations</span><span class="o">/</span><span class="mi">201204</span><span class="o">/</span><span class="n">Slice_002</span><span class="o">/</span><span class="n">Cell_001</span><span class="o">/</span><span class="n">Imgdata</span>
</pre></div>
</div>
<p>To simply restore the file content type in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">get</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
<p>If you no longer need to work on your repository and its remote copy is up to date with the local copy, you can simply delete the local repository copy altogether. You should always be able to restore your repository and all of its contents on your local machine by executing these commands in your terminal (replace the repository path as appropriate):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gin</span> <span class="n">get</span> <span class="n">dervinism</span><span class="o">/</span><span class="n">calcium</span><span class="o">-</span><span class="n">imaging</span><span class="o">-</span><span class="n">mock</span><span class="o">-</span><span class="n">repo</span>
<span class="n">cd</span> <span class="n">calcium</span><span class="o">-</span><span class="n">imaging</span><span class="o">-</span><span class="n">mock</span><span class="o">-</span><span class="n">repo</span>
<span class="n">gin</span> <span class="n">get</span><span class="o">-</span><span class="n">content</span>
</pre></div>
</div>
</section>
<section id="convert-your-data-to-standardised-format">
<span id="tutorials-caimage-convert2nwb"></span><h2>Convert Your Data to Standardised Format<a class="headerlink" href="#convert-your-data-to-standardised-format" title="Permalink to this headline">#</a></h2>
<p>In order to increase your research data’s adherence to the <a class="reference external" href="https://www.go-fair.org/fair-principles/">FAIR principles</a> of scientific data management and, in particular, to increase the interoperability of your data and chances of it being reused beyond its original purpose of collection, it is highly advisable to convert your data into one of the more popular standard file formats for neuroscience data. One such format is the <a class="reference external" href="https://www.nwb.org/">Neurodata Without Borders (NWB)</a> which is highly suitable for most of the neurophysiology data. Programming interfaces in both Matlab and Python are available for converting your data. Here we are going to provide explanations of how you can convert your data in both programming languages. While showing you examples of that, we will continue our focus on the calcium imaging data.</p>
<section id="convert-to-nwb-using-matlab">
<span id="tutorials-caimage-convert2nwb-matlab"></span><h3>Convert to NWB Using Matlab<a class="headerlink" href="#convert-to-nwb-using-matlab" title="Permalink to this headline">#</a></h3>
<section id="install-matnwb-toolbox">
<span id="tutorials-caimage-convert2nwb-matlab-install-matnwb"></span><h4>Install MatNWB Toolbox<a class="headerlink" href="#install-matnwb-toolbox" title="Permalink to this headline">#</a></h4>
<p>To begin with the Matlab demonstration, you would need to install <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/">MatNWB toolbox</a>. To download the toolbox, type in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">NeurodataWithoutBorders</span><span class="o">/</span><span class="n">matnwb</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Move the downloaded repository to the folder where you keep your code libraries. Then type the following in the Matlab command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">matnwb</span>
<span class="n">addpath</span><span class="p">(</span><span class="n">genpath</span><span class="p">(</span><span class="n">pwd</span><span class="p">));</span>
<span class="n">generateCore</span><span class="p">();</span>
</pre></div>
</div>
<p>You can now start using MatNWB. MatNWB interface documentation can be accessed <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/index.html">here</a>.</p>
</section>
<section id="record-metadata">
<span id="tutorials-caimage-convert2nwb-matlab-record-metadata"></span><h4>Record Metadata<a class="headerlink" href="#record-metadata" title="Permalink to this headline">#</a></h4>
<p>Inside the calcium imaging repository there is a folder with the Matlab file that you can execute in order to convert the data of one particular imaging/recording session into the NWB format. The script is located inside the <code class="docutils literal notranslate"><span class="pre">Exp_001_SCstim_DiffLocations/201204/Slice_00/Cell_001/nwb</span></code> folder in the file named <code class="docutils literal notranslate"><span class="pre">convert2nwbCaImg.m</span></code> and, if executed, it would convert the data stored in the files below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Exp_001_SCstim_DiffLocations</span><span class="o">/</span><span class="mi">201204</span><span class="o">/</span><span class="n">Slice_002</span><span class="o">/</span><span class="n">Cell_001</span><span class="o">/</span><span class="n">Analysed</span><span class="o">/</span><span class="mi">201204</span><span class="n">__s2d1_004_ED__1</span> <span class="n">Botden_Analysed</span><span class="o">.</span><span class="n">mat</span>
<span class="n">Exp_001_SCstim_DiffLocations</span><span class="o">/</span><span class="mi">201204</span><span class="o">/</span><span class="n">Slice_002</span><span class="o">/</span><span class="n">Cell_001</span><span class="o">/</span><span class="n">Analysed</span><span class="o">/</span><span class="mi">201204</span><span class="n">__s2d1_004_ED__1</span> <span class="n">Midden_Analysed</span><span class="o">.</span><span class="n">mat</span>
<span class="n">Exp_001_SCstim_DiffLocations</span><span class="o">/</span><span class="mi">201204</span><span class="o">/</span><span class="n">Slice_002</span><span class="o">/</span><span class="n">Cell_001</span><span class="o">/</span><span class="n">Analysed</span><span class="o">/</span><span class="mi">201204</span><span class="n">__s2d1_004_ED__1</span> <span class="n">Topden_Analysed</span><span class="o">.</span><span class="n">mat</span>
</pre></div>
</div>
<p>Initially, we start by recording the metadata associated with this experimental session. In this tutorial the metadata is divided into three types: Project, animal, and session metadata. The project metadata is common to all animals and experimental sessions and is defined by the part of the script below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">projectName</span> <span class="o">=</span> <span class="s1">&#39;Intracellular Ca2+ dynamics during plateau potentials trigerred by Schaffer collateral stimulation&#39;</span><span class="p">;</span>
<span class="n">experimenter</span> <span class="o">=</span> <span class="s1">&#39;Matt Udakis&#39;</span><span class="p">;</span>
<span class="n">institution</span> <span class="o">=</span> <span class="s1">&#39;University of Bristol&#39;</span><span class="p">;</span>
<span class="n">publications</span> <span class="o">=</span> <span class="s1">&#39;In preparation&#39;</span><span class="p">;</span>
<span class="n">lab</span> <span class="o">=</span> <span class="s1">&#39;Jack Mellor lab&#39;</span><span class="p">;</span>
<span class="n">brainArea</span> <span class="o">=</span> <span class="s1">&#39;Hippocampus CA1-2&#39;</span><span class="p">;</span>
<span class="n">greenIndicator</span> <span class="o">=</span> <span class="s1">&#39;Fluo5f&#39;</span><span class="p">;</span>
<span class="n">redIndicator</span> <span class="o">=</span> <span class="s1">&#39;Alexa594&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>The names of most of these parameters are self-explanatory. The green and red indicators are calcium indicator types named based on the light wavelength they emit. Next we define animal metadata. The reason to have this type of data separate is that multiple slices can be obtained from the same animal and used in separate imaging/recording sessions. The animal metadata is defined in the code snippet below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">animalID</span> <span class="o">=</span> <span class="s1">&#39;m1&#39;</span><span class="p">;</span>
<span class="n">ageInDays</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="n">age</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;P&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">ageInDays</span><span class="p">)</span> <span class="s1">&#39;D&#39;</span><span class="p">];</span> <span class="o">%</span> <span class="n">Convert</span> <span class="n">to</span> <span class="n">ISO8601</span> <span class="nb">format</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">en</span><span class="o">.</span><span class="n">wikipedia</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wiki</span><span class="o">/</span><span class="n">ISO_8601</span><span class="c1">#Durations</span>
<span class="n">strain</span> <span class="o">=</span> <span class="s1">&#39;C57BL/6J&#39;</span><span class="p">;</span>
<span class="n">sex</span> <span class="o">=</span> <span class="s1">&#39;M&#39;</span><span class="p">;</span>
<span class="n">species</span> <span class="o">=</span> <span class="s1">&#39;Mus musculus&#39;</span><span class="p">;</span>
<span class="n">weight</span> <span class="o">=</span> <span class="p">[];</span>
<span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;001&#39;</span><span class="p">;</span> <span class="o">%</span> <span class="n">Animal</span> <span class="n">testing</span> <span class="n">order</span><span class="o">.</span>
</pre></div>
</div>
<p>Names of these parameters are again self-explanatory. Finally, we define the subject level metadata in the code below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">startYear</span> <span class="o">=</span> <span class="mi">2020</span><span class="p">;</span>
<span class="n">startMonth</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="n">startDay</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="n">startTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">startYear</span><span class="p">,</span> <span class="n">startMonth</span><span class="p">,</span> <span class="n">startDay</span><span class="p">);</span>
<span class="o">...</span>
<span class="n">sliceNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">cellNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">imagingRate</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">21</span><span class="p">;</span> <span class="o">%</span> <span class="n">A</span> <span class="n">single</span> <span class="n">linescan</span> <span class="n">duration</span> <span class="ow">is</span> <span class="mi">1</span><span class="n">sec</span> <span class="k">with</span> <span class="mi">20</span><span class="n">sec</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">between</span> <span class="n">linescans</span>
<span class="n">lineRate</span> <span class="o">=</span> <span class="mf">1000.</span><span class="p">;</span> <span class="o">%</span> <span class="n">A</span> <span class="n">number</span> <span class="n">of</span> <span class="n">lines</span> <span class="n">scanned</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">second</span><span class="o">.</span>
<span class="n">sessionID</span> <span class="o">=</span> <span class="p">[</span><span class="n">animalID</span> <span class="s1">&#39;_&#39;</span> <span class="n">year</span> <span class="n">month</span> <span class="n">day</span> <span class="s1">&#39;_s&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)</span> <span class="o">...</span>
  <span class="s1">&#39;_c&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)];</span> <span class="o">%</span> <span class="n">mouse</span><span class="o">-</span><span class="n">id_time_slice</span><span class="o">-</span><span class="n">id_cell</span><span class="o">-</span><span class="nb">id</span>
<span class="n">sessionDescription</span> <span class="o">=</span> <span class="s1">&#39;Single cell imaging in a slice combined with somatic current clamp recordings and the stimulation of Schaffer collaterals&#39;</span><span class="p">;</span>
<span class="n">sessionNotes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;201204 - Slice 2 Imaging 3 dendrite regions roughly in the SO SR and SLM regions   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;Same line scan with same intensity of stim (2.3V) at different locations along the cell   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;Ephys frames to match up with linescans   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;Frames   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;1-8 Bottom Den   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;10-19 Middle Den   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;22-28 Top Dendrite   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;Missed a few of the imaging with the ephys so more Ephys traces than linescans   &#39;</span> <span class="o">...</span>
                <span class="s1">&#39;by the end of the experiment the top or neuron started to bleb.&#39;</span><span class="p">];</span>
</pre></div>
</div>
<p>Again, these variables are mostly self-explanatory or commented in the code. The sessionNotes variable is coming from the <code class="docutils literal notranslate"><span class="pre">Exp_001_SCstim_DiffLocations/201204/Slice_002/Cell_001/labbbook.txt</span></code> file.</p>
<p>The way you define your metadata may be different. For example, you may have your own custom scripts that contain the metadata or you may store your metadata in files organised according to one of standard neuroscientific metadata formats like <a class="reference external" href="http://g-node.github.io/python-odml/">odML</a>. Whichever your preference is, this part of the NWB conversion procedure will vary depending on the individual researcher.</p>
<p>The initialisation process is completed by intialising the Matlab NWB classes by calling</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">generateCore</span><span class="p">;</span>
</pre></div>
</div>
<p>We start the conversion process by creating an <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/NwbFile.html"><code class="docutils literal notranslate"><span class="pre">NWBFile</span></code></a> object and defining session metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Assign</span> <span class="n">NWB</span> <span class="n">file</span> <span class="n">fields</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">NwbFile</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;session_description&#39;</span><span class="p">,</span> <span class="n">sessionDescription</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;identifier&#39;</span><span class="p">,</span> <span class="n">sessionID</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;session_start_time&#39;</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;general_experimenter&#39;</span><span class="p">,</span> <span class="n">experimenter</span><span class="p">,</span> <span class="o">...</span> <span class="o">%</span> <span class="n">optional</span>
  <span class="s1">&#39;general_session_id&#39;</span><span class="p">,</span> <span class="n">sessionID</span><span class="p">,</span> <span class="o">...</span> <span class="o">%</span> <span class="n">optional</span>
  <span class="s1">&#39;general_institution&#39;</span><span class="p">,</span> <span class="n">institution</span><span class="p">,</span> <span class="o">...</span> <span class="o">%</span> <span class="n">optional</span>
  <span class="s1">&#39;general_related_publications&#39;</span><span class="p">,</span> <span class="n">publications</span><span class="p">,</span> <span class="o">...</span> <span class="o">%</span> <span class="n">optional</span>
  <span class="s1">&#39;general_notes&#39;</span><span class="p">,</span> <span class="n">sessionNotes</span><span class="p">,</span> <span class="o">...</span> <span class="o">%</span> <span class="n">optional</span>
  <span class="s1">&#39;general_lab&#39;</span><span class="p">,</span> <span class="n">lab</span><span class="p">);</span> <span class="o">%</span> <span class="n">optional</span>
</pre></div>
</div>
<p>Each file must have a <code class="docutils literal notranslate"><span class="pre">session_description</span></code> identifier and a <code class="docutils literal notranslate"><span class="pre">session_start_time</span></code> parameter. We then initialise the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/Subject.html"><code class="docutils literal notranslate"><span class="pre">Subject</span></code></a> object and the metadata it contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Create</span> <span class="n">subject</span> <span class="nb">object</span>
<span class="n">subject</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Subject</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;subject_id&#39;</span><span class="p">,</span> <span class="n">animalID</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;species&#39;</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="n">sex</span><span class="p">);</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">general_subject</span> <span class="o">=</span> <span class="n">subject</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="create-imaging-planes">
<span id="tutorials-caimage-convert2nwb-matlab-create-img-planes"></span><h4>Create Imaging Planes<a class="headerlink" href="#create-imaging-planes" title="Permalink to this headline">#</a></h4>
<p>In order to store optical imaging data, we need to create imaging planes. First, we create <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/OpticalChannel.html"><code class="docutils literal notranslate"><span class="pre">OpticalChannel</span></code></a> objects for each calcium indicator we use. The objects contain <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">emission_lambda</span></code> properties. In our case we use indicators Fluo5f and Alexa594 which have their maximum emission wavelengths at approximately 516 and 616 nanometers, respectively. These wavelength roughly correspond to green and red colours. Therefore, we name the channels based on the colours their corresponding calcium indicators emit.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">green_optical_channel</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">OpticalChannel</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;green channel corresponding to &#39;</span> <span class="n">greenIndicator</span><span class="p">],</span> <span class="o">...</span>
  <span class="s1">&#39;emission_lambda&#39;</span><span class="p">,</span> <span class="mf">516.</span><span class="p">);</span>

<span class="n">red_optical_channel</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">OpticalChannel</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;red channel corresponding to &#39;</span> <span class="n">redIndicator</span><span class="p">],</span> <span class="o">...</span>
  <span class="s1">&#39;emission_lambda&#39;</span><span class="p">,</span> <span class="mf">616.</span><span class="p">);</span>
</pre></div>
</div>
<p>Another needed prerequisite is the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/Device.html"><code class="docutils literal notranslate"><span class="pre">Device</span></code></a> object which is stored within the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object. Idealy, the <code class="docutils literal notranslate"><span class="pre">Device</span></code> object should have a <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">manufacturer</span></code> properties as defined below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">imaging</span> <span class="n">device</span> <span class="nb">object</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Two-photon microscope&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;Scientifica&#39;</span><span class="p">);</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">general_devices</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;2P_microscope&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>
</pre></div>
</div>
<p>We name the device as 2P_microscope but you are free to name it differently. Having created <code class="docutils literal notranslate"><span class="pre">OpticalChannel</span></code> and <code class="docutils literal notranslate"><span class="pre">Device</span></code> objects we can now create optical imaging planes corresponding to the green and red optical channels. We do this by executing the code below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Create</span> <span class="n">imaging</span> <span class="n">plane</span> <span class="n">objects</span>
<span class="n">imaging_plane_name</span> <span class="o">=</span> <span class="s1">&#39;green_imaging_plane&#39;</span><span class="p">;</span>
<span class="n">green_imaging_plane</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">ImagingPlane</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;optical_channel&#39;</span><span class="p">,</span> <span class="n">green_optical_channel</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;The plane for imaging calcium indicator Fluo5f.&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;device&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">untyped</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="o">...</span>
  <span class="s1">&#39;excitation_lambda&#39;</span><span class="p">,</span> <span class="mf">810.</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;imaging_rate&#39;</span><span class="p">,</span> <span class="n">imagingRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;indicator&#39;</span><span class="p">,</span> <span class="s1">&#39;Fluo5f&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">brainArea</span><span class="p">);</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">general_optophysiology</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">imaging_plane_name</span><span class="p">,</span> <span class="n">green_imaging_plane</span><span class="p">);</span>

<span class="n">imaging_plane_name</span> <span class="o">=</span> <span class="s1">&#39;red_imaging_plane&#39;</span><span class="p">;</span>
<span class="n">red_imaging_plane</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">ImagingPlane</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;optical_channel&#39;</span><span class="p">,</span> <span class="n">red_optical_channel</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;The plane for imaging calcium indicator Alexa594.&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;device&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">untyped</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="n">device</span><span class="p">),</span> <span class="o">...</span>
  <span class="s1">&#39;excitation_lambda&#39;</span><span class="p">,</span> <span class="mf">810.</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;imaging_rate&#39;</span><span class="p">,</span> <span class="n">imagingRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;indicator&#39;</span><span class="p">,</span> <span class="s1">&#39;Alexa594&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="n">brainArea</span><span class="p">);</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">general_optophysiology</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">imaging_plane_name</span><span class="p">,</span> <span class="n">red_imaging_plane</span><span class="p">);</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/ImagingPlane.html"><code class="docutils literal notranslate"><span class="pre">ImagingPlane</span></code></a> object defines various properties of imaging planes used to generate the optical physiology data. Required properties include <code class="docutils literal notranslate"><span class="pre">excitation_lambda</span></code> (the wavelength used to excite calcium indicators in nm), <code class="docutils literal notranslate"><span class="pre">indicator</span></code>, <code class="docutils literal notranslate"><span class="pre">location</span></code> (brain area where the imaging plane is located), <code class="docutils literal notranslate"><span class="pre">optical_channel</span></code> (previously created <code class="docutils literal notranslate"><span class="pre">OpticalChannel</span></code> objects), and <code class="docutils literal notranslate"><span class="pre">device</span></code> (a link to the <code class="docutils literal notranslate"><span class="pre">Device</span></code> object defining the two-photon microscope). You may have noticed that the <code class="docutils literal notranslate"><span class="pre">device</span></code> property is set as a <code class="docutils literal notranslate"><span class="pre">Softlink</span></code> object which is used to link to an already existing NWB object (in our case) or to an object within an NWB file using a path. It is also useful to provide <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">imaging_rate</span></code> (the rate at which individual linescans are obtained), and any other properties you deem necessary. Such properties may include <code class="docutils literal notranslate"><span class="pre">origin_coords</span></code> defining physical location of the first element of the imaging plane relative to some reference point (e.g., bregma; defined by the <code class="docutils literal notranslate"><span class="pre">reference_frame</span></code> property) and <code class="docutils literal notranslate"><span class="pre">grid_spacing</span></code> to define the distance between individual pixels within the imaging plane.</p>
</section>
<section id="load-imaging-recording-data">
<span id="tutorials-caimage-convert2nwb-matlab-load-data"></span><h4>Load Imaging/Recording Data<a class="headerlink" href="#load-imaging-recording-data" title="Permalink to this headline">#</a></h4>
<p>The next part of the conversion script loads aggregated and preprocessed data stored inside the three MAT files in the <code class="docutils literal notranslate"><span class="pre">Exp_001_SCstim_DiffLocations/201204/Slice_002/Cell_001/Analysed</span></code> folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Load</span> <span class="n">data</span>
<span class="n">dendrite</span> <span class="o">=</span> <span class="s1">&#39;Bot&#39;</span><span class="p">;</span>
<span class="n">data1</span> <span class="o">=</span> <span class="n">load</span><span class="p">([</span><span class="s1">&#39;..\Analysed</span><span class="se">\&#39;</span><span class="s1"> year month day &#39;</span><span class="n">__s</span><span class="s1">&#39; num2str(sliceNumber) ...</span>
  <span class="s1">&#39;d&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="s1">&#39;_004_ED__1 &#39;</span> <span class="n">dendrite</span> <span class="s1">&#39;den_Analysed.mat&#39;</span><span class="p">]);</span>
<span class="n">dendrite</span> <span class="o">=</span> <span class="s1">&#39;Mid&#39;</span><span class="p">;</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">load</span><span class="p">([</span><span class="s1">&#39;..\Analysed</span><span class="se">\&#39;</span><span class="s1"> year month day &#39;</span><span class="n">__s</span><span class="s1">&#39; num2str(sliceNumber) ...</span>
  <span class="s1">&#39;d&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="s1">&#39;_004_ED__1 &#39;</span> <span class="n">dendrite</span> <span class="s1">&#39;den_Analysed.mat&#39;</span><span class="p">]);</span>
<span class="n">dendrite</span> <span class="o">=</span> <span class="s1">&#39;Top&#39;</span><span class="p">;</span>
<span class="n">data3</span> <span class="o">=</span> <span class="n">load</span><span class="p">([</span><span class="s1">&#39;..\Analysed</span><span class="se">\&#39;</span><span class="s1"> year month day &#39;</span><span class="n">__s</span><span class="s1">&#39; num2str(sliceNumber) ...</span>
  <span class="s1">&#39;d&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">cellNumber</span><span class="p">)</span> <span class="s1">&#39;_004_ED__1 &#39;</span> <span class="n">dendrite</span> <span class="s1">&#39;den_Analysed.mat&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Three MAT files correspond to three imaged regions of interest (ROIs) of the neuron. The first region of interest, refered to as the bottom dendrite, is the pyramidal cell dendrite located in the Stratum Oriens (SO) of the CA1-2 region of the hippocampus. This information is available in the <code class="docutils literal notranslate"><span class="pre">sessionNotes</span></code> variable. The remaining two files refered to as middle and top dendrite data correspond to ROIs located in the Stratum Radiatum (SR) and Stratum Lacunosum Moleculare (SLM), respectively.</p>
<p>The table below describes the variables inside the files.</p>
<table class="colwidths-auto table" id="tutorials-caimage-convert2nwb-matlab-variable-table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Variable</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ExpName</p></td>
<td><p><em>The experiment ID.</em></p></td>
</tr>
<tr class="row-odd"><td><p>Line_nums</p></td>
<td><p><em>A number of line scans for the experiment.</em></p></td>
</tr>
<tr class="row-even"><td><p>Frame_nums</p></td>
<td><p><em>A number of optical imaging frames (or electrophysiology recording sweeps) for the experiment.</em></p></td>
</tr>
<tr class="row-odd"><td><p>ROI_nums</p></td>
<td><p><em>A number of regions of interest (ROIs) in the experiment.</em></p></td>
</tr>
<tr class="row-even"><td><p>Ephys_Time</p></td>
<td><p><em>Time points for electrophysiology recordings in ms.</em></p></td>
</tr>
<tr class="row-odd"><td><p>Ephys_Avg</p></td>
<td><p><em>A membrane potential (mV) trace averaged over all sweeps for that ROI (see the lab book or <code class="docutils literal notranslate"><span class="pre">sessionNotes</span></code> for corresponding recording sweeps).</em></p></td>
</tr>
<tr class="row-even"><td><p>Calcium_Avg</p></td>
<td><p><em>An average linescan calcium trace (denoised dF/F) (averaged over all linescans for that ROI).</em></p></td>
</tr>
<tr class="row-odd"><td><p>Calcium_Time</p></td>
<td><p><em>Time points for calcium imaging in ms.</em></p></td>
</tr>
<tr class="row-even"><td><p>Calcium_deltaF</p></td>
<td><p><em>Individual linescan calcium traces (denoised dF/F averaged across the width of the imaged dendrite).</em></p></td>
</tr>
<tr class="row-odd"><td><p>Ephys_data</p></td>
<td><p><em>Raw membrane potential (mV) data. Recording sweeps include all ROIs (see the lab book or <code class="docutils literal notranslate"><span class="pre">sessionNotes</span></code> for the corresponding sweeps for this particular ROI).</em></p></td>
</tr>
<tr class="row-even"><td><p>Flur5_denoised</p></td>
<td><p><em>Individual linescan images of the calcium indicator Fluo5f data run through denoising algorithm (the image was cropped to the linescan region). Dimensions correspond to dendritic geometry (length and width). The length is also a time dimension.</em></p></td>
</tr>
<tr class="row-odd"><td><p>Alexa_denoised</p></td>
<td><p><em>Individual linescan images of Alexa594 structure data run through denoising algorithm (the image was cropped to the linescan region). Dimensions have the same correspondance as for Flur5_denoised.</em></p></td>
</tr>
<tr class="row-even"><td><p>imaging_vars</p></td>
<td><p><em>Variables from ScanImage software for the two-photon acquisitions.</em></p></td>
</tr>
<tr class="row-odd"><td><p>Neuron</p></td>
<td><p><em>A stitched image of the filled neuron recorded from (a 3-channel colourmap image).</em></p></td>
</tr>
<tr class="row-even"><td><p>ROI_img</p></td>
<td><p><em>An image of the ROI recorded from (a grayscale image).</em></p></td>
</tr>
</tbody>
</table>
<p><strong>Table 1. Preprocessed Data</strong></p>
<p>We are interested in <code class="docutils literal notranslate"><span class="pre">Ephys_Time</span></code>, <code class="docutils literal notranslate"><span class="pre">Calcium_Time</span></code>, <code class="docutils literal notranslate"><span class="pre">Calcium_deltaF</span></code>, <code class="docutils literal notranslate"><span class="pre">Ephys_data</span></code>, <code class="docutils literal notranslate"><span class="pre">Flur5_denoised</span></code>, <code class="docutils literal notranslate"><span class="pre">Alexa_denoised</span></code>, <code class="docutils literal notranslate"><span class="pre">Neuron</span></code>, and <code class="docutils literal notranslate"><span class="pre">ROI_img</span></code> and are going to work with these variables during the tutorial.</p>
<p>As part of laoding the data, we also convert the variables with fluorescence data to the regular array form. For that purpose the array dimensions of data inside cell arrays have to be equalised by appending data using NaNs. This is done by passing cell arrays to the <code class="docutils literal notranslate"><span class="pre">appendLinescans</span></code> function which then outputs regular 3D arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Append</span> <span class="n">raw</span> <span class="n">linescans</span> <span class="n">so</span> <span class="n">they</span> <span class="n">have</span> <span class="n">equal</span> <span class="n">widths</span>
<span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span> <span class="o">=</span> <span class="n">appendLinescans</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span><span class="p">);</span>
<span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Alexa_denoised</span> <span class="o">=</span> <span class="n">appendLinescans</span><span class="p">(</span><span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Alexa_denoised</span><span class="p">);</span>
<span class="n">data2</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span> <span class="o">=</span> <span class="n">appendLinescans</span><span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span><span class="p">);</span>
<span class="n">data2</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Alexa_denoised</span> <span class="o">=</span> <span class="n">appendLinescans</span><span class="p">(</span><span class="n">data2</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Alexa_denoised</span><span class="p">);</span>
<span class="n">data3</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span> <span class="o">=</span> <span class="n">appendLinescans</span><span class="p">(</span><span class="n">data3</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span><span class="p">);</span>
<span class="n">data3</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Alexa_denoised</span> <span class="o">=</span> <span class="n">appendLinescans</span><span class="p">(</span><span class="n">data3</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Alexa_denoised</span><span class="p">);</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="convert-fluorescence-data">
<span id="tutorials-caimage-convert2nwb-matlab-convert-fluorescence"></span><h4>Convert Fluorescence Data<a class="headerlink" href="#convert-fluorescence-data" title="Permalink to this headline">#</a></h4>
<p>We convert the fluorescence data by invoking <code class="docutils literal notranslate"><span class="pre">setTwoPhotonSeries</span></code> function as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span><span class="o">.</span><span class="n">indicator</span> <span class="o">=</span> <span class="n">greenIndicator</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">imagingPlane</span> <span class="o">=</span> <span class="n">green_imaging_plane</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">imagingRate</span> <span class="o">=</span> <span class="n">imagingRate</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">lineRate</span> <span class="o">=</span> <span class="n">lineRate</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Flur5_denoised</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">;</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">setTwoPhotonSeries</span><span class="p">(</span><span class="n">nwb</span><span class="p">,</span> <span class="nb">input</span><span class="p">);</span>
<span class="o">...</span>
</pre></div>
</div>
<p>This is repeated six times to process fluorescence data for the two different calcium indicators and the three different ROIs (2x3). The conversion function body code is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Create</span> <span class="n">image</span> <span class="n">series</span>
<span class="n">image_series</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">TwoPhotonSeries</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">indicator</span> <span class="s1">&#39; linescans of the &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="s1">&#39; dendrite&#39;</span><span class="p">],</span> <span class="o">...</span>
  <span class="s1">&#39;imaging_plane&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">untyped</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">imagingPlane</span><span class="p">),</span> <span class="o">...</span>
  <span class="s1">&#39;starting_time&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;starting_time_rate&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">imagingRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;scan_line_rate&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">lineRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;a.u.&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data_continuity&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;This two-photon series contains &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">indicator</span> <span class="s1">&#39; linescans of the &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="s1">&#39; (ROI) with the first dimension corresponding to time &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;(or to individual linescans). Each linescan is 1-sec in duration with &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;20-sec intervals between two linescans. The second dimension corresponds &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;to individual lines spanning the length of the dendrite in the ROI. &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;The third dimension corresponds to the width of the dendrite. &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;Some linescans may contain appended NaN values to make &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;widths of different linescans be equal within the same ROI.&#39;</span><span class="p">]);</span>

<span class="o">%</span> <span class="n">Name</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">the</span> <span class="n">two</span><span class="o">-</span><span class="n">photon</span> <span class="n">series</span> <span class="n">to</span> <span class="n">the</span> <span class="n">NWB</span> <span class="n">file</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">indicator</span><span class="p">,</span> <span class="s1">&#39;Fluo5f&#39;</span><span class="p">)</span>
  <span class="n">opticalChannel</span> <span class="o">=</span> <span class="s1">&#39;Green&#39;</span><span class="p">;</span>
<span class="n">elseif</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">indicator</span><span class="p">,</span> <span class="s1">&#39;Alexa594&#39;</span><span class="p">)</span>
  <span class="n">opticalChannel</span> <span class="o">=</span> <span class="s1">&#39;Red&#39;</span><span class="p">;</span>
<span class="n">end</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
  <span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
<span class="n">elseif</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">)</span>
  <span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span><span class="p">;</span>
<span class="n">elseif</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span>
  <span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span><span class="p">;</span>
<span class="n">end</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="s1">&#39;TwoPhotonSeries&#39;</span> <span class="n">opticalChannel</span> <span class="n">dendriteID</span><span class="p">],</span> <span class="n">image_series</span><span class="p">);</span>
</pre></div>
</div>
<p>The fluorescence data is added to the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object by creating a <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/TwoPhotonSeries.html"><code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code></a> object. <code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code> object has the following required properties: <code class="docutils literal notranslate"><span class="pre">data</span></code>, <code class="docutils literal notranslate"><span class="pre">imaging_plane</span></code>, and <code class="docutils literal notranslate"><span class="pre">starting_time_rate</span></code>. In our case, the <code class="docutils literal notranslate"><span class="pre">data</span></code> property contains the actual fluorescence data in a 3D array form with its dimensions described in [Table 1].(tutorials-caimage-convert2nwb-matlab-variable-table) (<code class="docutils literal notranslate"><span class="pre">Flur5_denoised</span></code> and <code class="docutils literal notranslate"><span class="pre">Alexa_denoised</span></code> variables). The <code class="docutils literal notranslate"><span class="pre">imaging_plane</span></code> property uses the <code class="docutils literal notranslate"><span class="pre">SoftLink</span></code> object to link to a particular <code class="docutils literal notranslate"><span class="pre">ImagingPlane</span></code> object (in our case there are two: green and red). The <code class="docutils literal notranslate"><span class="pre">starting_time_rate</span></code> property corresponds to the rate at which individual linescans were acquired. However, it does not need to be organised this way and can refer to a different data dimension. Therefore, it is important to use <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">comments</span></code>, and <code class="docutils literal notranslate"><span class="pre">data_continuity</span></code> properties to explain how the data is organised. For example, data containing individual linescans is not continuous and should be described as having the step quality by the <code class="docutils literal notranslate"><span class="pre">data_continuity</span></code> property. The property <code class="docutils literal notranslate"><span class="pre">scan_line_rate</span></code> describes the rate at which individual image lines were obtained and corresponds to the second dimension of the data.</p>
</section>
<section id="convert-change-in-fluorescence-intensity-data">
<span id="tutorials-caimage-convert2nwb-matlab-convert-fluorescence-intensity-change"></span><h4>Convert Change in Fluorescence Intensity Data<a class="headerlink" href="#convert-change-in-fluorescence-intensity-data" title="Permalink to this headline">#</a></h4>
<p>In addition to converting the denoised fluorescence signal we are also going to convert the change in fluorescence intensity data (delta fluorescence). The delta F estimate is derived from the Alexa594 calcium indicator data or the red colour channel signal. It is stored using the <code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code> object similar to the denoised raw fluorescence data as described in the previous subsection. We perform conversion for all three ROIs as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Add</span> <span class="n">optical</span> <span class="n">physiology</span> <span class="n">data</span><span class="p">:</span> <span class="n">delta</span> <span class="n">fluorescence</span>
<span class="nb">input</span><span class="o">.</span><span class="n">indicator</span> <span class="o">=</span> <span class="n">redIndicator</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">imagingPlane</span> <span class="o">=</span> <span class="n">red_imaging_plane</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">imagingRate</span> <span class="o">=</span> <span class="n">imagingRate</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">lineRate</span> <span class="o">=</span> <span class="n">lineRate</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Calcium_deltaF</span><span class="s1">&#39;;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">;</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">setDeltaFSeries</span><span class="p">(</span><span class="n">nwb</span><span class="p">,</span> <span class="nb">input</span><span class="p">);</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The actual conversion is performed by the <code class="docutils literal notranslate"><span class="pre">setDeltaFSeries</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Create</span> <span class="n">image</span> <span class="n">series</span>
<span class="n">image_series</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">TwoPhotonSeries</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Delta F data for the &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="o">...</span>
                  <span class="s1">&#39; calculated based on &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">indicator</span> <span class="s1">&#39;.&#39;</span><span class="p">],</span> <span class="o">...</span>
  <span class="s1">&#39;imaging_plane&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">untyped</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">imagingPlane</span><span class="p">),</span> <span class="o">...</span>
  <span class="s1">&#39;starting_time&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;starting_time_rate&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">imagingRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;scan_line_rate&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">lineRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;normalised&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data_continuity&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;This two-photon series contains delta F data calculated based on &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="nb">input</span><span class="o">.</span><span class="n">indicator</span> <span class="s1">&#39; for the &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="s1">&#39; (ROI) &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;with the first dimension corresponding to time &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;(or to individual linescans). Each linescan is 1-sec in duration with &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;20-sec intervals between two linescans. The second dimension corresponds &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;to individual lines spanning the length of the dendrite in the ROI. &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;The data is averaged across the dendritic width.&#39;</span><span class="p">]);</span>

<span class="o">%</span> <span class="n">Name</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">the</span> <span class="n">two</span><span class="o">-</span><span class="n">photon</span> <span class="n">delta</span> <span class="n">F</span> <span class="n">series</span> <span class="n">to</span> <span class="n">the</span> <span class="n">NWB</span> <span class="n">file</span>
<span class="k">if</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
  <span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span>
<span class="n">elseif</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">)</span>
  <span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span><span class="p">;</span>
<span class="n">elseif</span> <span class="n">strcmpi</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span>
  <span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span><span class="p">;</span>
<span class="n">end</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="s1">&#39;TwoPhotonDeltaFSeries&#39;</span> <span class="n">dendriteID</span><span class="p">],</span> <span class="n">image_series</span><span class="p">);</span>
</pre></div>
</div>
<p>The delta F data has only two dimensions as the signal is averaged across the dendritic width (<code class="docutils literal notranslate"><span class="pre">Calcium_deltaF</span></code> variable described in <a class="reference internal" href="#tutorials-caimage-convert2nwb-matlab-variable-table"><span class="std std-ref">Table 1</span></a>).</p>
<p>All <code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code> objects are stored within the <code class="docutils literal notranslate"><span class="pre">acquisition</span></code> data interface of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object. However, this is not the only way of storing ROI fluorescence data. Alternatively, this type of data could be stored by defining an image mask used to extract ROI data from the wider fluorescence imaging data. If this is how you have obtained your own data, then it is worth consulting a different calcium imaging tutorial available <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/ophys.html">here</a>.</p>
</section>
<section id="convert-static-fluorescence-images">
<span id="tutorials-caimage-convert2nwb-matlab-convert-images"></span><h4>Convert Static Fluorescence Images<a class="headerlink" href="#convert-static-fluorescence-images" title="Permalink to this headline">#</a></h4>
<p>As a final step of converting your calcium imaging data you may want to add static neuron and ROI images to your NWB file. Static colour images can be stored as <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/RGBImage.html"><code class="docutils literal notranslate"><span class="pre">RGBImage</span></code></a> objects with the <code class="docutils literal notranslate"><span class="pre">data</span></code> property containing an array that has the spatial dimensions plus the third dimension corresponding to colour (three planes of RGB values; <code class="docutils literal notranslate"><span class="pre">Neuron</span></code> variable described in <a class="reference internal" href="#tutorials-caimage-convert2nwb-matlab-variable-table"><span class="std std-ref">Table 1</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">neuron_image</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">RGBImage</span><span class="p">(</span> <span class="o">...</span>
    <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Neuron</span><span class="p">,</span> <span class="o">...</span>  <span class="o">%</span> <span class="n">required</span><span class="p">:</span> <span class="p">[</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">colour</span><span class="p">]</span>
    <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;RGB image of the full neuron.&#39;</span> <span class="o">...</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Similarly, grayscale ROI images can be stored using <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/GrayscaleImage.html"><code class="docutils literal notranslate"><span class="pre">GrayscaleImage</span></code></a> objects (<code class="docutils literal notranslate"><span class="pre">ROI_img</span></code> variable described in <a class="reference internal" href="#tutorials-caimage-convert2nwb-matlab-variable-table"><span class="std std-ref">Table 1</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bottom_dend_image</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">GrayscaleImage</span><span class="p">(</span> <span class="o">...</span>
    <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">ROI_img</span><span class="p">,</span> <span class="o">...</span>  <span class="o">%</span> <span class="n">required</span><span class="p">:</span> <span class="p">[</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">]</span>
    <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Grayscale image of the bottom dendrite.&#39;</span> <span class="o">...</span>
<span class="p">);</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Images are then grouped together using the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/Images.html"><code class="docutils literal notranslate"><span class="pre">Images</span></code></a> object and added to the <code class="docutils literal notranslate"><span class="pre">acquisition</span></code> data interface of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object as an <code class="docutils literal notranslate"><span class="pre">ImageCollection</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image_collection</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Images</span><span class="p">(</span> <span class="o">...</span>
    <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;A collection of neuron and dendrite images.&#39;</span><span class="o">...</span>
<span class="p">);</span>
<span class="n">image_collection</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;neuron_image&#39;</span><span class="p">,</span> <span class="n">neuron_image</span><span class="p">);</span>
<span class="n">image_collection</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dendrite1_image&#39;</span><span class="p">,</span> <span class="n">bottom_dend_image</span><span class="p">);</span>
<span class="n">image_collection</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dendrite2_image&#39;</span><span class="p">,</span> <span class="n">middle_dend_image</span><span class="p">);</span>
<span class="n">image_collection</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;dendrite3_image&#39;</span><span class="p">,</span> <span class="n">top_dend_image</span><span class="p">);</span>

<span class="n">nwb</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;ImageCollection&#39;</span><span class="p">,</span> <span class="n">image_collection</span><span class="p">);</span>
</pre></div>
</div>
<p>This completes the conversion of the calcium imaging data into the NWB format.</p>
</section>
<section id="convert-intracellular-electrophysiology-recording-data">
<span id="tutorials-caimage-convert2nwb-matlab-convert-icephys"></span><h4>Convert Intracellular Electrophysiology Recording Data<a class="headerlink" href="#convert-intracellular-electrophysiology-recording-data" title="Permalink to this headline">#</a></h4>
<p>The calcium imaging data during this experiment were acquired in parallel to simultaneous intracellular somatic current clamp recordings in the imaged neuron. The recording sweeps are stored in the <code class="docutils literal notranslate"><span class="pre">Ephys_data</span></code> variable described in <a class="reference internal" href="#tutorials-caimage-convert2nwb-matlab-variable-table"><span class="std std-ref">Table 1</span></a>. The variable contains recording sweeps corresponding to all three ROI imaging data. Note that the sweeps cover the first 950 ms of corresponding calcium imaging linescans. Analogously to the imaging data, we start by creating the recording device Amplifier_Multiclamp_700A:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Create</span> <span class="n">the</span> <span class="n">recording</span> <span class="n">device</span> <span class="nb">object</span>
<span class="n">device</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplifier for recording current clamp data.&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;manufacturer&#39;</span><span class="p">,</span> <span class="s1">&#39;Molecular Devices&#39;</span><span class="p">);</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">general_devices</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;Amplifier_Multiclamp_700A&#39;</span><span class="p">,</span> <span class="n">device</span><span class="p">);</span>
</pre></div>
</div>
<p>Then follow this by creating the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/IntracellularElectrode.html"><code class="docutils literal notranslate"><span class="pre">IntracellularElectrode</span></code></a> object while providing any relevant information about it including the associated <code class="docutils literal notranslate"><span class="pre">Device</span></code> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">electrode</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">IntracellularElectrode</span><span class="p">(</span> <span class="o">...</span>
    <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="s1">&#39;A patch clamp electrode&#39;</span><span class="p">,</span> <span class="o">...</span>
    <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;Cell soma in CA1-2 of hippocampus&#39;</span><span class="p">,</span> <span class="o">...</span>
    <span class="s1">&#39;slice&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;slice #&#39;</span> <span class="n">num2str</span><span class="p">(</span><span class="n">sliceNumber</span><span class="p">)],</span> <span class="o">...</span>
    <span class="s1">&#39;device&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">untyped</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="n">device</span><span class="p">));</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">general_intracellular_ephys</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;icephys_electrode&#39;</span><span class="p">,</span> <span class="n">electrode</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, we convert the intracellular current clamp recordings using the <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/+types/+core/CurrentClampSeries.html"><code class="docutils literal notranslate"><span class="pre">CurrentClampSeries</span></code></a> object by passing data to the <code class="docutils literal notranslate"><span class="pre">setCClampSeries</span></code> function for all ROIs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span><span class="o">.</span><span class="n">ephysTime</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Ephys_Time</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">nSweeps</span> <span class="o">=</span> <span class="n">nFrames</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data1</span><span class="o">.</span><span class="n">Analysed_data</span><span class="o">.</span><span class="n">Ephys_data</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">imagingRate</span> <span class="o">=</span> <span class="n">imagingRate</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">electrode</span> <span class="o">=</span> <span class="n">electrode</span><span class="p">;</span>
<span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span><span class="p">;</span>
<span class="n">nwb</span> <span class="o">=</span> <span class="n">setCClampSeries</span><span class="p">(</span><span class="n">nwb</span><span class="p">,</span> <span class="nb">input</span><span class="p">);</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The function code is given below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">current_clamp_series</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">CurrentClampSeries</span><span class="p">(</span> <span class="o">...</span>
  <span class="s1">&#39;description&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Somatic current clamp recording corresponding to &#39;</span><span class="p">,</span> <span class="o">...</span>
                  <span class="s1">&#39;the initial part of the calcium imaging period &#39;</span><span class="p">,</span> <span class="o">...</span>
                  <span class="s1">&#39;at &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="s1">&#39; dendrite.&#39;</span><span class="p">],</span> <span class="o">...</span>
  <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span><span class="p">(:,</span><span class="n">sweeps</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="s1">&#39;, ...</span>
  <span class="s1">&#39;data_continuity&#39;</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;data_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;millivolt&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;starting_time&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;starting_time_rate&#39;</span><span class="p">,</span> <span class="nb">input</span><span class="o">.</span><span class="n">imagingRate</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;electrode&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">untyped</span><span class="o">.</span><span class="n">SoftLink</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">electrode</span><span class="p">),</span> <span class="o">...</span>
  <span class="s1">&#39;stimulus_description&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;timestamps&#39;</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="o">...</span>
  <span class="s1">&#39;comments&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Somatic current clamp recording corresponding to &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;the initial part of the calcium imaging period &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;at &#39;</span> <span class="nb">input</span><span class="o">.</span><span class="n">dendriteID</span> <span class="s1">&#39; dendrite.&#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;The first dimension corresponds to individual &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;recording sweeps. The second dimension corresponds to &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;individual sweep data samples. The associated timestamps &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;variable provides timestamps for the second dimension. &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;This variable has to be combined with starting_time and &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;starting_time_rate variables to get absolute timestamps &#39;</span><span class="p">,</span> <span class="o">...</span>
               <span class="s1">&#39;for each data point&#39;</span><span class="p">]);</span>
<span class="n">nwb</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="s1">&#39;CurrentClampSeries&#39;</span> <span class="n">dendriteID</span><span class="p">],</span>  <span class="n">current_clamp_series</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">CurrentClampSeries</span></code> is similar to the <code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code> object. The difference is that, while creating the former, we need to provide a link to the electrode object and, since there is no <code class="docutils literal notranslate"><span class="pre">scan_line_rate</span></code> property, we need to add the <code class="docutils literal notranslate"><span class="pre">timestamps</span></code> variable corresponding to the second dimension of the electrophysiology data (<code class="docutils literal notranslate"><span class="pre">Ephys_Time</span></code> and <code class="docutils literal notranslate"><span class="pre">Ephys_data</span></code> variables defined in <a class="reference internal" href="#tutorials-caimage-convert2nwb-matlab-variable-table"><span class="std std-ref">Table 1</span></a>, respectively).</p>
</section>
<section id="save-nwb-file">
<span id="tutorials-caimage-convert2nwb-matlab-save"></span><h4>Save NWB File<a class="headerlink" href="#save-nwb-file" title="Permalink to this headline">#</a></h4>
<p>We call the <code class="docutils literal notranslate"><span class="pre">nwbExport</span></code> function to save our data in the NWB format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span> <span class="n">Save</span> <span class="n">the</span> <span class="n">converted</span> <span class="n">NWB</span> <span class="n">file</span>
<span class="n">nwbExport</span><span class="p">(</span><span class="n">nwb</span><span class="p">,</span> <span class="p">[</span><span class="n">sessionID</span> <span class="s1">&#39;.nwb&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="read-nwb-file">
<span id="tutorials-caimage-convert2nwb-matlab-read"></span><h4>Read NWB File<a class="headerlink" href="#read-nwb-file" title="Permalink to this headline">#</a></h4>
<p>Now if you want to open the NWB file that you just saved in Matlab, you can issue a command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nwb2</span> <span class="o">=</span> <span class="n">nwbRead</span><span class="p">(</span><span class="s1">&#39;m1_201204_s2_c1.nwb&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>which will read the file passively. The action is fast and it does not load all of the data at once but rather make it readily accessible. This is useful as it allows you to read data selectively without loading the entire file content into the computer memory.</p>
<p>In order to access stored two-photon calcium imaging data stored inside <code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code> objects, execute the code given below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TwoPhotonSeriesGreen1</span> <span class="o">=</span> <span class="n">nwb2</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;TwoPhotonSeriesGreen1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loadAll</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
<p>Other properties can be accessed similarly by replacing the <code class="docutils literal notranslate"><span class="pre">data</span></code> property with a relevant property name (e.g., <code class="docutils literal notranslate"><span class="pre">scan_line_rate</span></code>).</p>
<p>Stored images can be accessed by issuing the following command, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">neuronImage</span> <span class="o">=</span> <span class="n">nwb2</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ImageCollection&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;neuron_image&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loadAll</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
<p>Finally, voltage clamp data is accessible in a similar way to the <code class="docutils literal notranslate"><span class="pre">TwoPhotonSeries</span></code> objects. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CurrentClampSeries1</span> <span class="o">=</span> <span class="n">nwb2</span><span class="o">.</span><span class="n">acquisition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CurrentClampSeries1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">loadAll</span><span class="o">.</span><span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
<p>will give you recording sweeps obtained while imaging the bottom dendrite.</p>
<p>Some metadata is often directly available as properties of the <code class="docutils literal notranslate"><span class="pre">NWBFile</span></code> object, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sessionDescription</span> <span class="o">=</span> <span class="n">nwb2</span><span class="o">.</span><span class="n">session_description</span><span class="p">;</span>
</pre></div>
</div>
<p>Subject metadata is available via the command, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">animalID</span> <span class="o">=</span> <span class="n">nwb2</span><span class="o">.</span><span class="n">general_subject</span><span class="o">.</span><span class="n">subject_id</span><span class="p">;</span>
</pre></div>
</div>
<p>More on reading optical physiology data stored in NWB files can be found in an external tutorial <a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/ophys.html">here</a>.</p>
</section>
<section id="validate-nwb-file">
<span id="tutorials-caimage-convert2nwb-matlab-validate"></span><h4>Validate NWB File<a class="headerlink" href="#validate-nwb-file" title="Permalink to this headline">#</a></h4>
<p>MatNWB does not provide its own NWB file validator. However, you can validate NWB files generated using Matlab in Python. For instructions on how to do it, refer to the corresponding <a class="reference internal" href="#tutorials-caimage-convert2nwb-py-validate"><span class="std std-ref">PyNWB validation section</span></a> of the tutorial.</p>
</section>
<section id="resources">
<span id="tutorials-caimage-convert2nwb-matlab-resources"></span><h4>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">#</a></h4>
<p>This section explained how you can use Matlab to convert your calcium imaging and accompanying current clamp data into NWB files. It is not an exhaustive overview of Matnwb toolbox optical physiology functionality. There are other potential use cases involving imaging in multiple neurons while simultaneously recording behavioural data, for example. There is a number of externally available tutorials covering some aspects of converting data obtained in optical physiology experiments to the NWB file format using Matlab:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/intro.html">Intro to NWB Tutorial</a></p></li>
<li><p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/ophys.html">MatNWB Optical Physiology Tutorial</a></p></li>
<li><p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/images.html">Storing Image Data in NWB</a></p></li>
<li><p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/icephys.html">Intracellular Electrophysiology Tutorial</a></p></li>
<li><p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/tutorials/html/behavior.html">Behavior Data Tutorial</a></p></li>
<li><p><a class="reference external" href="https://neurodatawithoutborders.github.io/matnwb/doc/index.html">MatNWB API Documentation</a></p></li>
<li><p><a class="reference external" href="https://nwb-schema.readthedocs.io/en/latest/index.html">NWB Schema Overview</a></p></li>
</ul>
</section>
</section>
<section id="convert-to-nwb-using-python">
<span id="tutorials-caimage-convert2nwb-py"></span><h3>Convert to NWB Using Python<a class="headerlink" href="#convert-to-nwb-using-python" title="Permalink to this headline">#</a></h3>
<section id="install-pynwb">
<span id="tutorials-caimage-convert2nwb-py-install"></span><h4>Install PyNWB<a class="headerlink" href="#install-pynwb" title="Permalink to this headline">#</a></h4>
<p>To convert your extracellular electrophysiology data, you will need to install PyNWB first. To do so, type in your terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">pynwb</span>
</pre></div>
</div>
<p>Now you’re ready to start working with PyNWB. The full installation instructions are available <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/install_users.html">here</a>.</p>
</section>
<section id="tutorials-caimage-convert2nwb-py-validate">
<span id="id1"></span><h4>Validate NWB File<a class="headerlink" href="#tutorials-caimage-convert2nwb-py-validate" title="Permalink to this headline">#</a></h4>
<p>For validating NWB files use command line and type in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pynwb</span><span class="o">.</span><span class="n">validate</span> <span class="n">m1_201204_s2_c1</span><span class="o">.</span><span class="n">nwb</span>
</pre></div>
</div>
<p>in order to validate the file that was recently created. The output should be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Validating</span> <span class="n">m1_201204_s2_c1</span><span class="o">.</span><span class="n">nwb</span> <span class="n">against</span> <span class="n">cached</span> <span class="n">namespace</span> <span class="n">information</span> <span class="n">using</span> <span class="n">namespace</span> <span class="s1">&#39;core&#39;</span><span class="o">.</span>
 <span class="o">-</span> <span class="n">no</span> <span class="n">errors</span> <span class="n">found</span><span class="o">.</span>
</pre></div>
</div>
<p>The program exit code should be 0. On error, the program exit code is 1 and the list of errors is outputted.</p>
<p>For more details on the validation process, refer to an external <a class="reference external" href="https://pynwb.readthedocs.io/en/stable/validation.html">resource</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is work in progress. Current priority!</p>
</div>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="Bristol%20GIN%20for%20Patch%20Clamp%20Data.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Bristol GIN for Patch Clamp Data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Bristol%20GIN%20for%20Neuroimaging%20Data.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bristol GIN for Neuroimaging Data</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Martynas Dervinis<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>